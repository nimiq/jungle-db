require=function t(e,n,r){function o(i,s){if(!n[i]){if(!e[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};e[i][0].call(l.exports,function(t){return o(e[i][1][t]||t)},l,l.exports,t,e,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){var r=function(){return this}()||Function("return this")(),a=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,i=a&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,t.exports=e("./runtime"),a)r.regeneratorRuntime=i;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},{"./runtime":2}],2:[function(e,t,n){!function(r){"use strict";var a,o=Object.prototype,s=o.hasOwnProperty,u="function"==typeof Symbol?Symbol:{},c=u.iterator||"@@iterator",l=u.asyncIterator||"@@asyncIterator",f=u.toStringTag||"@@toStringTag",h="object"==typeof t,d=r.regeneratorRuntime;if(d)h&&(t.exports=d);else{(d=r.regeneratorRuntime=h?t.exports:{}).wrap=g;var _="suspendedStart",p="suspendedYield",y="executing",v="completed",m={},b={};b[c]=function(){return this};var C=Object.getPrototypeOf,A=C&&C(C(T([])));A&&A!==o&&s.call(A,c)&&(b=A);var B=k.prototype=x.prototype=Object.create(b);w.prototype=B.constructor=k,k.constructor=w,k[f]=w.displayName="GeneratorFunction",d.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},d.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,f in e||(e[f]="GeneratorFunction")),e.prototype=Object.create(B),e},d.awrap=function(e){return{__await:e}},O(S.prototype),S.prototype[l]=function(){return this},d.AsyncIterator=S,d.async=function(e,t,n,r){var a=new S(g(e,t,n,r));return d.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},O(B),B[f]="Generator",B[c]=function(){return this},B.toString=function(){return"[object Generator]"},d.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},d.values=T,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(L),!e)for(var t in this)"t"===t.charAt(0)&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=a)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=a),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=s.call(i,"catchLoc"),c=s.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&s.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),L(n),m}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;L(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:T(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=a),m}}}function g(e,t,n,r){var a=t&&t.prototype instanceof x?t:x,i=Object.create(a.prototype),o=new P(r||[]);return i._invoke=function(e,t,n){var r=_;return function(a,i){if(r===y)throw new Error("Generator is already running");if(r===v){if("throw"===a)throw i;return F()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=M(o,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===_)throw r=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=y;var u=j(e,t,n);if("normal"===u.type){if(r=n.done?v:p,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=v,n.method="throw",n.arg=u.arg)}}}(e,n,o),i}function j(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function x(){}function w(){}function k(){}function O(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function S(t){var n;this._invoke=function(e,r){function i(){return new Promise(function(n,a){!function e(n,r,a,i){var o=j(t[n],t,r);if("throw"!==o.type){var u=o.arg,c=u.value;return c&&"object"==typeof c&&s.call(c,"__await")?Promise.resolve(c.__await).then(function(t){e("next",t,a,i)},function(t){e("throw",t,a,i)}):Promise.resolve(c).then(function(e){u.value=e,a(u)},i)}i(o.arg)}(e,r,n,a)})}return n=n?n.then(i,i):i()}}function M(e,t){var n=e.iterator[t.method];if(n===a){if(t.delegate=null,"throw"===t.method){if(e.iterator["return"]&&(t.method="return",t.arg=a,M(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var r=j(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,m;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=a),t.delegate=null,m):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function T(t){if(t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(s.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=a,e.done=!0,e};return i.next=i}}return{next:F}}function F(){return{value:a,done:!0}}}(function(){return this}()||Function("return this")())},{}],3:[function(e,t,n){e("../../modules/es6.string.iterator"),e("../../modules/es6.array.from"),t.exports=e("../../modules/_core").Array.from},{"../../modules/_core":23,"../../modules/es6.array.from":87,"../../modules/es6.string.iterator":99}],4:[function(e,t,n){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":86,"../modules/es6.string.iterator":99,"../modules/web.dom.iterable":103}],5:[function(e,t,n){var r=e("../../modules/_core"),a=r.JSON||(r.JSON={stringify:JSON.stringify});t.exports=function(e){return a.stringify.apply(a,arguments)}},{"../../modules/_core":23}],6:[function(e,t,n){e("../../modules/es6.math.clz32"),t.exports=e("../../modules/_core").Math.clz32},{"../../modules/_core":23,"../../modules/es6.math.clz32":89}],7:[function(e,t,n){e("../../modules/es6.math.fround"),t.exports=e("../../modules/_core").Math.fround},{"../../modules/_core":23,"../../modules/es6.math.fround":90}],8:[function(e,t,n){e("../../modules/es6.math.imul"),t.exports=e("../../modules/_core").Math.imul},{"../../modules/_core":23,"../../modules/es6.math.imul":91}],9:[function(e,t,n){e("../../modules/es6.math.trunc"),t.exports=e("../../modules/_core").Math.trunc},{"../../modules/_core":23,"../../modules/es6.math.trunc":92}],10:[function(e,t,n){e("../../modules/es6.number.is-integer"),t.exports=e("../../modules/_core").Number.isInteger},{"../../modules/_core":23,"../../modules/es6.number.is-integer":93}],11:[function(e,t,n){e("../../modules/es6.number.max-safe-integer"),t.exports=9007199254740991},{"../../modules/es6.number.max-safe-integer":94}],12:[function(e,t,n){e("../../modules/es6.object.freeze"),t.exports=e("../../modules/_core").Object.freeze},{"../../modules/_core":23,"../../modules/es6.object.freeze":95}],13:[function(e,t,n){e("../../modules/es6.object.keys"),t.exports=e("../../modules/_core").Object.keys},{"../../modules/_core":23,"../../modules/es6.object.keys":96}],14:[function(e,t,n){e("../../modules/es7.object.values"),t.exports=e("../../modules/_core").Object.values},{"../../modules/_core":23,"../../modules/es7.object.values":100}],15:[function(e,t,n){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.promise"),e("../modules/es7.promise.finally"),e("../modules/es7.promise.try"),t.exports=e("../modules/_core").Promise},{"../modules/_core":23,"../modules/es6.object.to-string":97,"../modules/es6.promise":98,"../modules/es6.string.iterator":99,"../modules/es7.promise.finally":101,"../modules/es7.promise.try":102,"../modules/web.dom.iterable":103}],16:[function(e,t,n){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],17:[function(e,t,n){t.exports=function(){}},{}],18:[function(e,t,n){t.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},{}],19:[function(e,t,n){var r=e("./_is-object");t.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":42}],20:[function(e,t,n){var r=e("./_to-iobject"),a=e("./_to-length"),i=e("./_to-absolute-index");t.exports=function(e){return function(t,n,o){var s,u=r(t),c=a(u.length),l=i(o,c);if(e&&n!=n){for(;c>l;)if((s=u[l++])!=s)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}},{"./_to-absolute-index":76,"./_to-iobject":78,"./_to-length":79}],21:[function(e,t,n){var r=e("./_cof"),a=e("./_wks")("toStringTag"),i="Arguments"==r(function(){return arguments}());t.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?n:i?r(t):"Object"==(o=r(t))&&"function"==typeof t.callee?"Arguments":o}},{"./_cof":22,"./_wks":84}],22:[function(e,t,n){var r={}.toString;t.exports=function(e){return r.call(e).slice(8,-1)}},{}],23:[function(e,t,n){var r=t.exports={version:"2.6.11"};"number"==typeof __e&&(__e=r)},{}],24:[function(e,t,n){"use strict";var r=e("./_object-dp"),a=e("./_property-desc");t.exports=function(e,t,n){t in e?r.f(e,t,a(0,n)):e[t]=n}},{"./_object-dp":56,"./_property-desc":66}],25:[function(e,t,n){var r=e("./_a-function");t.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,a){return e.call(t,n,r,a)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":16}],26:[function(e,t,n){t.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},{}],27:[function(e,t,n){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":31}],28:[function(e,t,n){var r=e("./_is-object"),a=e("./_global").document,i=r(a)&&r(a.createElement);t.exports=function(e){return i?a.createElement(e):{}}},{"./_global":33,"./_is-object":42}],29:[function(e,t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],30:[function(e,t,n){var r=e("./_global"),a=e("./_core"),i=e("./_ctx"),o=e("./_hide"),s=e("./_has"),u=function(e,t,n){var c,l,f,h=e&u.F,d=e&u.G,_=e&u.S,p=e&u.P,y=e&u.B,v=e&u.W,g=d?a:a[t]||(a[t]={}),k=g.prototype,m=d?r:_?r[t]:(r[t]||{}).prototype;for(c in d&&(n=t),n)(l=!h&&m&&void 0!==m[c])&&s(g,c)||(f=l?m[c]:n[c],g[c]=d&&"function"!=typeof m[c]?n[c]:y&&l?i(f,r):v&&m[c]==f?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(f):p&&"function"==typeof f?i(Function.call,f):f,p&&((g.virtual||(g.virtual={}))[c]=f,e&u.R&&k&&!k[c]&&o(k,c,f)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,t.exports=u},{"./_core":23,"./_ctx":25,"./_global":33,"./_has":34,"./_hide":35}],31:[function(e,t,n){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],32:[function(e,t,n){var r=e("./_ctx"),a=e("./_iter-call"),i=e("./_is-array-iter"),o=e("./_an-object"),s=e("./_to-length"),u=e("./core.get-iterator-method"),c={},l={};(n=t.exports=function(e,t,n,f,h){var d,_,p,y,v=h?function(){return e}:u(e),g=r(n,f,t?2:1),k=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(i(v)){for(d=s(e.length);d>k;k++)if((y=t?g(o(_=e[k])[0],_[1]):g(e[k]))===c||y===l)return y}else for(p=v.call(e);!(_=p.next()).done;)if((y=a(p,g,_.value,t))===c||y===l)return y}).BREAK=c,n.RETURN=l},{"./_an-object":19,"./_ctx":25,"./_is-array-iter":40,"./_iter-call":43,"./_to-length":79,"./core.get-iterator-method":85}],33:[function(e,t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},{}],34:[function(e,t,n){var r={}.hasOwnProperty;t.exports=function(e,t){return r.call(e,t)}},{}],35:[function(e,t,n){var r=e("./_object-dp"),a=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,n){return r.f(e,t,a(1,n))}:function(e,t,n){return e[t]=n,e}},{"./_descriptors":27,"./_object-dp":56,"./_property-desc":66}],36:[function(e,t,n){var r=e("./_global").document;t.exports=r&&r.documentElement},{"./_global":33}],37:[function(e,t,n){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":27,"./_dom-create":28,"./_fails":31}],38:[function(e,t,n){t.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},{}],39:[function(e,t,n){var r=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},{"./_cof":22}],40:[function(e,t,n){var r=e("./_iterators"),a=e("./_wks")("iterator"),i=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||i[a]===e)}},{"./_iterators":48,"./_wks":84}],41:[function(e,t,n){var r=e("./_is-object"),a=Math.floor;t.exports=function(e){return!r(e)&&isFinite(e)&&a(e)===e}},{"./_is-object":42}],42:[function(e,t,n){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],43:[function(e,t,n){var r=e("./_an-object");t.exports=function(e,t,n,a){try{return a?t(r(n)[0],n[1]):t(n)}catch(t){var i=e["return"];throw void 0!==i&&r(i.call(e)),t}}},{"./_an-object":19}],44:[function(e,t,n){"use strict";var r=e("./_object-create"),a=e("./_property-desc"),i=e("./_set-to-string-tag"),o={};e("./_hide")(o,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,n){e.prototype=r(o,{next:a(1,n)}),i(e,t+" Iterator")}},{"./_hide":35,"./_object-create":55,"./_property-desc":66,"./_set-to-string-tag":70,"./_wks":84}],45:[function(e,t,n){"use strict";var r=e("./_library"),a=e("./_export"),i=e("./_redefine"),o=e("./_hide"),s=e("./_iterators"),u=e("./_iter-create"),c=e("./_set-to-string-tag"),l=e("./_object-gpo"),f=e("./_wks")("iterator"),h=!([].keys&&"next"in[].keys()),d=function(){return this};t.exports=function(e,t,n,_,p,y,v){u(n,t,_);var g,k,m,b=function(e){if(!h&&e in T)return T[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},x=t+" Iterator",w="values"==p,S=!1,T=e.prototype,E=T[f]||T["@@iterator"]||p&&T[p],O=E||b(p),C=p?w?b("entries"):O:void 0,j="Array"==t&&T.entries||E;if(j&&(m=l(j.call(new e)))!==Object.prototype&&m.next&&(c(m,x,!0),r||"function"==typeof m[f]||o(m,f,d)),w&&E&&"values"!==E.name&&(S=!0,O=function(){return E.call(this)}),r&&!v||!h&&!S&&T[f]||o(T,f,O),s[t]=O,s[x]=d,p)if(g={values:w?O:b("values"),keys:y?O:b("keys"),entries:C},v)for(k in g)k in T||i(T,k,g[k]);else a(a.P+a.F*(h||S),t,g);return g}},{"./_export":30,"./_hide":35,"./_iter-create":44,"./_iterators":48,"./_library":49,"./_object-gpo":58,"./_redefine":68,"./_set-to-string-tag":70,"./_wks":84}],46:[function(e,t,n){var r=e("./_wks")("iterator"),a=!1;try{var i=[7][r]();i["return"]=function(){a=!0},Array.from(i,function(){throw 2})}catch(e){}t.exports=function(e,t){if(!t&&!a)return!1;var n=!1;try{var i=[7],o=i[r]();o.next=function(){return{done:n=!0}},i[r]=function(){return o},e(i)}catch(e){}return n}},{"./_wks":84}],47:[function(e,t,n){t.exports=function(e,t){return{value:t,done:!!e}}},{}],48:[function(e,t,n){t.exports={}},{}],49:[function(e,t,n){t.exports=!0},{}],50:[function(e,t,n){var r=e("./_math-sign"),a=Math.pow,i=a(2,-52),o=a(2,-23),s=a(2,127)*(2-o),u=a(2,-126);t.exports=Math.fround||function(e){var t,n,a=Math.abs(e),c=r(e);return a<u?c*(a/u/o+1/i-1/i)*u*o:(n=(t=(1+o/i)*a)-(t-a))>s||n!=n?c*(1/0):c*n}},{"./_math-sign":51}],51:[function(e,t,n){t.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},{}],52:[function(e,t,n){var r=e("./_uid")("meta"),a=e("./_is-object"),i=e("./_has"),o=e("./_object-dp").f,s=0,u=Object.isExtensible||function(){return!0},c=!e("./_fails")(function(){return u(Object.preventExtensions({}))}),l=function(e){o(e,r,{value:{i:"O"+ ++s,w:{}}})},f=t.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,r)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!i(e,r)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return c&&f.NEED&&u(e)&&!i(e,r)&&l(e),e}}},{"./_fails":31,"./_has":34,"./_is-object":42,"./_object-dp":56,"./_uid":82}],53:[function(e,t,n){var r=e("./_global"),a=e("./_task").set,i=r.MutationObserver||r.WebKitMutationObserver,o=r.process,s=r.Promise,u="process"==e("./_cof")(o);t.exports=function(){var e,t,n,c=function(){var r,a;for(u&&(r=o.domain)&&r.exit();e;){a=e.fn,e=e.next;try{a()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){o.nextTick(c)};else if(!i||r.navigator&&r.navigator.standalone)if(s&&s.resolve){var l=s.resolve(void 0);n=function(){l.then(c)}}else n=function(){a.call(r,c)};else{var f=!0,h=document.createTextNode("");new i(c).observe(h,{characterData:!0}),n=function(){h.data=f=!f}}return function(r){var a={fn:r,next:void 0};t&&(t.next=a),e||(e=a,n()),t=a}}},{"./_cof":22,"./_global":33,"./_task":75}],54:[function(e,t,n){"use strict";var r=e("./_a-function");function o(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=r(t),this.reject=r(n)}t.exports.f=function(e){return new o(e)}},{"./_a-function":16}],55:[function(e,t,n){var r=e("./_an-object"),a=e("./_object-dps"),i=e("./_enum-bug-keys"),o=e("./_shared-key")("IE_PROTO"),s=function(){},u=function(){var t,n=e("./_dom-create")("iframe"),r=i.length;for(n.style.display="none",e("./_html").appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),u=t.F;r--;)delete u.prototype[i[r]];return u()};t.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=r(e),n=new s,s.prototype=null,n[o]=e):n=u(),void 0===t?n:a(n,t)}},{"./_an-object":19,"./_dom-create":28,"./_enum-bug-keys":29,"./_html":36,"./_object-dps":57,"./_shared-key":71}],56:[function(e,t,n){var r=e("./_an-object"),a=e("./_ie8-dom-define"),i=e("./_to-primitive"),o=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function(e,t,n){if(r(e),t=i(t,!0),r(n),a)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},{"./_an-object":19,"./_descriptors":27,"./_ie8-dom-define":37,"./_to-primitive":81}],57:[function(e,t,n){var r=e("./_object-dp"),a=e("./_an-object"),i=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){a(e);for(var n,o=i(t),s=o.length,u=0;s>u;)r.f(e,n=o[u++],t[n]);return e}},{"./_an-object":19,"./_descriptors":27,"./_object-dp":56,"./_object-keys":60}],58:[function(e,t,n){var r=e("./_has"),a=e("./_to-object"),i=e("./_shared-key")("IE_PROTO"),o=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=a(e),r(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},{"./_has":34,"./_shared-key":71,"./_to-object":80}],59:[function(e,t,n){var r=e("./_has"),a=e("./_to-iobject"),i=e("./_array-includes")(!1),o=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var n,s=a(e),u=0,c=[];for(n in s)n!=o&&r(s,n)&&c.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~i(c,n)||c.push(n));return c}},{"./_array-includes":20,"./_has":34,"./_shared-key":71,"./_to-iobject":78}],60:[function(e,t,n){var r=e("./_object-keys-internal"),a=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return r(e,a)}},{"./_enum-bug-keys":29,"./_object-keys-internal":59}],61:[function(e,t,n){n.f={}.propertyIsEnumerable},{}],62:[function(e,t,n){var r=e("./_export"),a=e("./_core"),i=e("./_fails");t.exports=function(e,t){var n=(a.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*i(function(){n(1)}),"Object",o)}},{"./_core":23,"./_export":30,"./_fails":31}],63:[function(e,t,n){var r=e("./_descriptors"),a=e("./_object-keys"),i=e("./_to-iobject"),o=e("./_object-pie").f;t.exports=function(e){return function(t){for(var n,s=i(t),u=a(s),c=u.length,l=0,f=[];c>l;)n=u[l++],r&&!o.call(s,n)||f.push(e?[n,s[n]]:s[n]);return f}}},{"./_descriptors":27,"./_object-keys":60,"./_object-pie":61,"./_to-iobject":78}],64:[function(e,t,n){t.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},{}],65:[function(e,t,n){var r=e("./_an-object"),a=e("./_is-object"),i=e("./_new-promise-capability");t.exports=function(e,t){if(r(e),a(t)&&t.constructor===e)return t;var n=i.f(e);return(0,n.resolve)(t),n.promise}},{"./_an-object":19,"./_is-object":42,"./_new-promise-capability":54}],66:[function(e,t,n){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],67:[function(e,t,n){var r=e("./_hide");t.exports=function(e,t,n){for(var a in t)n&&e[a]?e[a]=t[a]:r(e,a,t[a]);return e}},{"./_hide":35}],68:[function(e,t,n){t.exports=e("./_hide")},{"./_hide":35}],69:[function(e,t,n){"use strict";var r=e("./_global"),a=e("./_core"),i=e("./_object-dp"),o=e("./_descriptors"),s=e("./_wks")("species");t.exports=function(e){var t="function"==typeof a[e]?a[e]:r[e];o&&t&&!t[s]&&i.f(t,s,{configurable:!0,get:function(){return this}})}},{"./_core":23,"./_descriptors":27,"./_global":33,"./_object-dp":56,"./_wks":84}],70:[function(e,t,n){var r=e("./_object-dp").f,a=e("./_has"),i=e("./_wks")("toStringTag");t.exports=function(e,t,n){e&&!a(e=n?e:e.prototype,i)&&r(e,i,{configurable:!0,value:t})}},{"./_has":34,"./_object-dp":56,"./_wks":84}],71:[function(e,t,n){var r=e("./_shared")("keys"),a=e("./_uid");t.exports=function(e){return r[e]||(r[e]=a(e))}},{"./_shared":72,"./_uid":82}],72:[function(e,t,n){var r=e("./_core"),a=e("./_global"),i=a["__core-js_shared__"]||(a["__core-js_shared__"]={});(t.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:e("./_library")?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},{"./_core":23,"./_global":33,"./_library":49}],73:[function(e,t,n){var r=e("./_an-object"),a=e("./_a-function"),i=e("./_wks")("species");t.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||null==(n=r(o)[i])?t:a(n)}},{"./_a-function":16,"./_an-object":19,"./_wks":84}],74:[function(e,t,n){var r=e("./_to-integer"),a=e("./_defined");t.exports=function(e){return function(t,n){var i,o,s=String(a(t)),u=r(n),c=s.length;return u<0||u>=c?e?"":void 0:(i=s.charCodeAt(u))<55296||i>56319||u+1===c||(o=s.charCodeAt(u+1))<56320||o>57343?e?s.charAt(u):i:e?s.slice(u,u+2):o-56320+(i-55296<<10)+65536}}},{"./_defined":26,"./_to-integer":77}],75:[function(e,t,n){var r,a,i,o=e("./_ctx"),s=e("./_invoke"),u=e("./_html"),c=e("./_dom-create"),l=e("./_global"),f=l.process,h=l.setImmediate,d=l.clearImmediate,_=l.MessageChannel,p=l.Dispatch,y=0,v={},g=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},k=function(e){g.call(e.data)};h&&d||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return v[++y]=function(){s("function"==typeof e?e:Function(e),t)},r(y),y},d=function(e){delete v[e]},"process"==e("./_cof")(f)?r=function(e){f.nextTick(o(g,e,1))}:p&&p.now?r=function(e){p.now(o(g,e,1))}:_?(i=(a=new _).port2,a.port1.onmessage=k,r=o(i.postMessage,i,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",k,!1)):r="onreadystatechange"in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this),g.call(e)}}:function(e){setTimeout(o(g,e,1),0)}),t.exports={set:h,clear:d}},{"./_cof":22,"./_ctx":25,"./_dom-create":28,"./_global":33,"./_html":36,"./_invoke":38}],76:[function(e,t,n){var r=e("./_to-integer"),a=Math.max,i=Math.min;t.exports=function(e,t){return(e=r(e))<0?a(e+t,0):i(e,t)}},{"./_to-integer":77}],77:[function(e,t,n){var r=Math.ceil,a=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?a:r)(e)}},{}],78:[function(e,t,n){var r=e("./_iobject"),a=e("./_defined");t.exports=function(e){return r(a(e))}},{"./_defined":26,"./_iobject":39}],79:[function(e,t,n){var r=e("./_to-integer"),a=Math.min;t.exports=function(e){return e>0?a(r(e),9007199254740991):0}},{"./_to-integer":77}],80:[function(e,t,n){var r=e("./_defined");t.exports=function(e){return Object(r(e))}},{"./_defined":26}],81:[function(e,t,n){var r=e("./_is-object");t.exports=function(e,t){if(!r(e))return e;var n,a;if(t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;if("function"==typeof(n=e.valueOf)&&!r(a=n.call(e)))return a;if(!t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":42}],82:[function(e,t,n){var r=0,a=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+a).toString(36))}},{}],83:[function(e,t,n){var r=e("./_global").navigator;t.exports=r&&r.userAgent||""},{"./_global":33}],84:[function(e,t,n){var r=e("./_shared")("wks"),a=e("./_uid"),i=e("./_global").Symbol,o="function"==typeof i;(t.exports=function(e){return r[e]||(r[e]=o&&i[e]||(o?i:a)("Symbol."+e))}).store=r},{"./_global":33,"./_shared":72,"./_uid":82}],85:[function(e,t,n){var r=e("./_classof"),a=e("./_wks")("iterator"),i=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){if(null!=e)return e[a]||e["@@iterator"]||i[r(e)]}},{"./_classof":21,"./_core":23,"./_iterators":48,"./_wks":84}],86:[function(e,t,n){var r=e("./_an-object"),a=e("./core.get-iterator-method");t.exports=e("./_core").getIterator=function(e){var t=a(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},{"./_an-object":19,"./_core":23,"./core.get-iterator-method":85}],87:[function(e,t,n){"use strict";var r=e("./_ctx"),a=e("./_export"),i=e("./_to-object"),o=e("./_iter-call"),s=e("./_is-array-iter"),u=e("./_to-length"),c=e("./_create-property"),l=e("./core.get-iterator-method");a(a.S+a.F*!e("./_iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,a,f,h=i(e),d="function"==typeof this?this:Array,_=arguments.length,p=_>1?arguments[1]:void 0,y=void 0!==p,v=0,g=l(h);if(y&&(p=r(p,_>2?arguments[2]:void 0,2)),null==g||d==Array&&s(g))for(n=new d(t=u(h.length));t>v;v++)c(n,v,y?p(h[v],v):h[v]);else for(f=g.call(h),n=new d;!(a=f.next()).done;v++)c(n,v,y?o(f,p,[a.value,v],!0):a.value);return n.length=v,n}})},{"./_create-property":24,"./_ctx":25,"./_export":30,"./_is-array-iter":40,"./_iter-call":43,"./_iter-detect":46,"./_to-length":79,"./_to-object":80,"./core.get-iterator-method":85}],88:[function(e,t,n){"use strict";var r=e("./_add-to-unscopables"),a=e("./_iter-step"),i=e("./_iterators"),o=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,a(1)):a(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},{"./_add-to-unscopables":17,"./_iter-define":45,"./_iter-step":47,"./_iterators":48,"./_to-iobject":78}],89:[function(e,t,n){var r=e("./_export");r(r.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},{"./_export":30}],90:[function(e,t,n){var r=e("./_export");r(r.S,"Math",{fround:e("./_math-fround")})},{"./_export":30,"./_math-fround":50}],91:[function(e,t,n){var r=e("./_export"),a=Math.imul;r(r.S+r.F*e("./_fails")(function(){return-5!=a(4294967295,5)||2!=a.length}),"Math",{imul:function(e,t){var n=+e,r=+t,a=65535&n,i=65535&r;return 0|a*i+((65535&n>>>16)*i+a*(65535&r>>>16)<<16>>>0)}})},{"./_export":30,"./_fails":31}],92:[function(e,t,n){var r=e("./_export");r(r.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},{"./_export":30}],93:[function(e,t,n){var r=e("./_export");r(r.S,"Number",{isInteger:e("./_is-integer")})},{"./_export":30,"./_is-integer":41}],94:[function(e,t,n){var r=e("./_export");r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},{"./_export":30}],95:[function(e,t,n){var r=e("./_is-object"),a=e("./_meta").onFreeze;e("./_object-sap")("freeze",function(e){return function(t){return e&&r(t)?e(a(t)):t}})},{"./_is-object":42,"./_meta":52,"./_object-sap":62}],96:[function(e,t,n){var r=e("./_to-object"),a=e("./_object-keys");e("./_object-sap")("keys",function(){return function(e){return a(r(e))}})},{"./_object-keys":60,"./_object-sap":62,"./_to-object":80}],97:[function(e,t,n){},{}],98:[function(e,t,n){"use strict";var r,a,i,o,s=e("./_library"),u=e("./_global"),c=e("./_ctx"),l=e("./_classof"),f=e("./_export"),h=e("./_is-object"),d=e("./_a-function"),_=e("./_an-instance"),p=e("./_for-of"),y=e("./_species-constructor"),v=e("./_task").set,g=e("./_microtask")(),k=e("./_new-promise-capability"),m=e("./_perform"),b=e("./_user-agent"),x=e("./_promise-resolve"),w=u.TypeError,S=u.process,T=S&&S.versions,E=T&&T.v8||"",O=u.Promise,C="process"==l(S),j=function(){},A=a=k.f,B=!!function(){try{var t=O.resolve(1),n=(t.constructor={})[e("./_wks")("species")]=function(e){e(j,j)};return(C||"function"==typeof PromiseRejectionEvent)&&t.then(j)instanceof n&&0!==E.indexOf("6.6")&&-1===b.indexOf("Chrome/66")}catch(e){}}(),I=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},P=function(e,t){if(!e._n){e._n=!0;var n=e._c;g(function(){for(var r=e._v,a=1==e._s,i=0,o=function(t){var n,i,o,s=a?t.ok:t.fail,u=t.resolve,c=t.reject,l=t.domain;try{s?(a||(2==e._h&&N(e),e._h=1),!0===s?n=r:(l&&l.enter(),n=s(r),l&&(l.exit(),o=!0)),n===t.promise?c(w("Promise-chain cycle")):(i=I(n))?i.call(n,u,c):u(n)):c(r)}catch(e){l&&!o&&l.exit(),c(e)}};n.length>i;)o(n[i++]);e._c=[],e._n=!1,t&&!e._h&&L(e)})}},L=function(e){v.call(u,function(){var t,n,r,a=e._v,i=R(e);if(i&&(t=m(function(){C?S.emit("unhandledRejection",a,e):(n=u.onunhandledrejection)?n({promise:e,reason:a}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",a)}),e._h=C||R(e)?2:1),e._a=void 0,i&&t.e)throw t.v})},R=function(e){return 1!==e._h&&0===(e._a||e._c).length},N=function(e){v.call(u,function(){var t;C?S.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})})},D=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),P(t,!0))},G=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw w("Promise can't be resolved itself");(t=I(e))?g(function(){var r={_w:n,_d:!1};try{t.call(e,c(G,r,1),c(D,r,1))}catch(e){D.call(r,e)}}):(n._v=e,n._s=1,P(n,!1))}catch(e){D.call({_w:n,_d:!1},e)}}};B||(O=function(e){_(this,O,"Promise","_h"),d(e),r.call(this);try{e(c(G,this,1),c(D,this,1))}catch(e){D.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=e("./_redefine-all")(O.prototype,{then:function(e,t){var n=A(y(this,O));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=C?S.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&P(this,!1),n.promise},"catch":function(e){return this.then(void 0,e)}}),i=function(){var e=new r;this.promise=e,this.resolve=c(G,e,1),this.reject=c(D,e,1)},k.f=A=function(e){return e===O||e===o?new i(e):a(e)}),f(f.G+f.W+f.F*!B,{Promise:O}),e("./_set-to-string-tag")(O,"Promise"),e("./_set-species")("Promise"),o=e("./_core").Promise,f(f.S+f.F*!B,"Promise",{reject:function(e){var t=A(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(s||!B),"Promise",{resolve:function(e){return x(s&&this===o?O:this,e)}}),f(f.S+f.F*!(B&&e("./_iter-detect")(function(e){O.all(e)["catch"](j)})),"Promise",{all:function(e){var t=this,n=A(t),r=n.resolve,a=n.reject,i=m(function(){var n=[],i=0,o=1;p(e,!1,function(e){var s=i++,u=!1;n.push(void 0),o++,t.resolve(e).then(function(e){u||(u=!0,n[s]=e,--o||r(n))},a)}),--o||r(n)});return i.e&&a(i.v),n.promise},race:function(e){var t=this,n=A(t),r=n.reject,a=m(function(){p(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return a.e&&r(a.v),n.promise}})},{"./_a-function":16,"./_an-instance":18,"./_classof":21,"./_core":23,"./_ctx":25,"./_export":30,"./_for-of":32,"./_global":33,"./_is-object":42,"./_iter-detect":46,"./_library":49,"./_microtask":53,"./_new-promise-capability":54,"./_perform":64,"./_promise-resolve":65,"./_redefine-all":67,"./_set-species":69,"./_set-to-string-tag":70,"./_species-constructor":73,"./_task":75,"./_user-agent":83,"./_wks":84}],99:[function(e,t,n){"use strict";var r=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},{"./_iter-define":45,"./_string-at":74}],100:[function(e,t,n){var r=e("./_export"),a=e("./_object-to-array")(!1);r(r.S,"Object",{values:function(e){return a(e)}})},{"./_export":30,"./_object-to-array":63}],101:[function(e,t,n){"use strict";var r=e("./_export"),a=e("./_core"),i=e("./_global"),o=e("./_species-constructor"),s=e("./_promise-resolve");r(r.P+r.R,"Promise",{"finally":function(e){var t=o(this,a.Promise||i.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then(function(){return n})}:e,n?function(n){return s(t,e()).then(function(){throw n})}:e)}})},{"./_core":23,"./_export":30,"./_global":33,"./_promise-resolve":65,"./_species-constructor":73}],102:[function(e,t,n){"use strict";var r=e("./_export"),a=e("./_new-promise-capability"),i=e("./_perform");r(r.S,"Promise",{"try":function(e){var t=a.f(this),n=i(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},{"./_export":30,"./_new-promise-capability":54,"./_perform":64}],103:[function(e,t,n){e("./es6.array.iterator");for(var r=e("./_global"),a=e("./_hide"),i=e("./_iterators"),o=e("./_wks")("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<s.length;u++){var c=s[u],l=r[c],f=l&&l.prototype;f&&!f[o]&&a(f,o,c),i[c]=i.Array}},{"./_global":33,"./_hide":35,"./_iterators":48,"./_wks":84,"./es6.array.iterator":88}],"babel-runtime/core-js/array/from":[function(e,t,n){t.exports={"default":e("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":3}],"babel-runtime/core-js/get-iterator":[function(e,t,n){t.exports={"default":e("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":4}],"babel-runtime/core-js/json/stringify":[function(e,t,n){t.exports={"default":e("core-js/library/fn/json/stringify"),__esModule:!0}},{"core-js/library/fn/json/stringify":5}],"babel-runtime/core-js/math/clz32":[function(e,t,n){t.exports={"default":e("core-js/library/fn/math/clz32"),__esModule:!0}},{"core-js/library/fn/math/clz32":6}],"babel-runtime/core-js/math/fround":[function(e,t,n){t.exports={"default":e("core-js/library/fn/math/fround"),__esModule:!0}},{"core-js/library/fn/math/fround":7}],"babel-runtime/core-js/math/imul":[function(e,t,n){t.exports={"default":e("core-js/library/fn/math/imul"),__esModule:!0}},{"core-js/library/fn/math/imul":8}],"babel-runtime/core-js/math/trunc":[function(e,t,n){t.exports={"default":e("core-js/library/fn/math/trunc"),__esModule:!0}},{"core-js/library/fn/math/trunc":9}],"babel-runtime/core-js/number/is-integer":[function(e,t,n){t.exports={"default":e("core-js/library/fn/number/is-integer"),__esModule:!0}},{"core-js/library/fn/number/is-integer":10}],"babel-runtime/core-js/number/max-safe-integer":[function(e,t,n){t.exports={"default":e("core-js/library/fn/number/max-safe-integer"),__esModule:!0}},{"core-js/library/fn/number/max-safe-integer":11}],"babel-runtime/core-js/object/freeze":[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/freeze"),__esModule:!0}},{"core-js/library/fn/object/freeze":12}],"babel-runtime/core-js/object/keys":[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/keys"),__esModule:!0}},{"core-js/library/fn/object/keys":13}],"babel-runtime/core-js/object/values":[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/values"),__esModule:!0}},{"core-js/library/fn/object/values":14}],"babel-runtime/core-js/promise":[function(e,t,n){t.exports={"default":e("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":15}],"babel-runtime/helpers/asyncToGenerator":[function(e,t,r){"use strict";r.__esModule=!0;var a,i=(a=e("../core-js/promise"))&&a.__esModule?a:{"default":a};r["default"]=function(e){return function(){var t=e.apply(this,arguments);return new i["default"](function(e,r){return function n(a,o){try{var s=t[a](o),u=s.value}catch(e){return void r(e)}if(!s.done)return i["default"].resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}},{"../core-js/promise":"babel-runtime/core-js/promise"}],"babel-runtime/regenerator":[function(e,t,n){t.exports=e("regenerator-runtime")},{"regenerator-runtime":1}]},{},[]);var _Proxy,_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_get6=_interopRequireDefault(require("@babel/runtime/helpers/get")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_construct2=_interopRequireDefault(require("@babel/runtime/helpers/construct")),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));function _createSuper(e){var t=_isNativeReflectConstruct();return function _createSuperInternal(){var n,r=(0,_getPrototypeOf2["default"])(e);if(t){var a=(0,_getPrototypeOf2["default"])(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,_possibleConstructorReturn2["default"])(this,n)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return!0}catch(e){return!1}}function _createForOfIteratorHelper(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,i=function F(){};return{s:i,n:function n(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(t){function e(e){return t.apply(this,arguments)}e.toString=function(){return t.toString()};return e}(function(e){throw e}),f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,c=!1;return{s:function s(){r=e[Symbol.iterator]()},n:function n(){var e=r.next();u=e.done;return e},e:function(t){function e(e){return t.apply(this,arguments)}e.toString=function(){return t.toString()};return e}(function(e){c=!0;o=e}),f:function f(){try{u||null==r["return"]||r["return"]()}finally{if(c)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);return"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}if("undefined"==typeof JDB)var JDB={};!function(e){e="undefined"!=typeof e?e:{};var t=function(){function Class(){(0,_classCallCheck2["default"])(this,Class)}(0,_createClass2["default"])(Class,null,[{key:"register",value:function register(t){"undefined"!=typeof e&&(e[t.name]=t)}}]);return Class}();t.register(t);var n=function(){function LogNative(){(0,_classCallCheck2["default"])(this,LogNative);this._global_level=g.TRACE;this._tag_levels={};try{if(window.localStorage)try{var e=window.localStorage.getItem("log_tag_levels");e&&"string"==typeof e&&(e=JSON.parse(e));e&&"object"===(0,_typeof2["default"])(e)&&(this._tag_levels=e)}catch(t){console.warn("Failed to load log configuration from local storage.")}}catch(t){}}(0,_createClass2["default"])(LogNative,[{key:"isLoggable",value:function isLoggable(e,t){return e&&this._tag_levels[e]?this._tag_levels[e]<=t:this._tag_levels["*"]?this._tag_levels["*"]<=t:this._global_level<=t}},{key:"setLoggable",value:function setLoggable(e,t){e&&e.name&&(e=e.name);this._tag_levels[e]=t;window.localStorage&&window.localStorage.setItem("log_tag_levels",JSON.stringify(this._tag_levels))}},{key:"msg",value:function msg(e,t,n){t&&t.name&&(t=t.name);if(this.isLoggable(t,e)){t&&n.unshift(t+":");n.unshift("[".concat(g.Level.toStringTag(e)," ").concat((new Date).toTimeString().substr(0,8),"]"));console.error&&e>=g.ERROR?console.error.apply(console,n):console.warn&&e>=g.WARNING?console.warn.apply(console,n):console.info&&e>=g.INFO?console.info.apply(console,n):console.debug&&e>=g.DEBUG?console.debug.apply(console,n):console.trace&&e<=g.TRACE?console.trace.apply(console,n):console.log.apply(console,n)}}}]);return LogNative}();t.register(n);var r=function(){function IDBTools(){(0,_classCallCheck2["default"])(this,IDBTools)}(0,_createClass2["default"])(IDBTools,null,[{key:"convertKeyRange",value:function convertKeyRange(e){return e instanceof A?e.exactMatch?IDBKeyRange.only(e.lower):e.lower!==undefined&&e.upper===undefined?IDBKeyRange.lowerBound(e.lower,e.lowerOpen):e.upper!==undefined&&e.lower===undefined?IDBKeyRange.upperBound(e.upper,e.upperOpen):IDBKeyRange.bound(e.lower,e.upper,e.lowerOpen,e.upperOpen):e}}]);return IDBTools}();t.register(r);var a=function(){function IDBBackend(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;(0,_classCallCheck2["default"])(this,IDBBackend);this._db=e;this._tableName=t;this._indices=new Map;this._indicesToCreate=new Map;this._indicesToDelete=[];this._codec=n}(0,_createClass2["default"])(IDBBackend,[{key:"init",value:function init(e,t,n){var r,a=_createForOfIteratorHelper(this._indicesToDelete);try{for(a.s();!(r=a.n()).done;){var i=r.value,o=i.indexName,s=i.upgradeCondition;e.indexNames.contains(o)&&(null===s||!0===s||"function"==typeof s&&s(t,n))&&e.deleteIndex(o)}}catch(y){a.e(y)}finally{a.f()}this._indicesToDelete=[];var u,c=_createForOfIteratorHelper(this._indicesToCreate);try{for(c.s();!(u=c.n()).done;){var l=(0,_slicedToArray2["default"])(u.value,2),f=l[0],h=l[1],d=h.index,_=h.upgradeCondition;if(!e.indexNames.contains(f)&&(null===_||!0===_||"function"==typeof _&&_(t,n))){var p=Array.isArray(d.keyPath)?d.keyPath.join("."):d.keyPath;e.createIndex(f,p,{unique:d.unique,multiEntry:d.multiEntry})}}}catch(y){c.e(y)}finally{c.f()}this._indicesToCreate.clear()}},{key:"decode",value:function decode(e,t){return e===undefined?undefined:null!==this._codec&&this._codec!==undefined?this._codec.decode(e,t):e}},{key:"encode",value:function encode(e){return e===undefined?undefined:null!==this._codec&&this._codec!==undefined?this._codec.encode(e):e}},{key:"get",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(e){var t,n,r=this,a=arguments;return _regenerator["default"].wrap(function _callee$(i){for(;;)switch(i.prev=i.next){case 0:t=a.length>1&&a[1]!==undefined?a[1]:{};n=this._backend;return i.abrupt("return",new Promise(function(a,i){var o=n.transaction([r._tableName]).objectStore(r._tableName).get(e);o.onsuccess=function(n){try{a(t&&t.raw?n.target.result:r.decode(n.target.result,e))}catch(o){i(o)}};o.onerror=i}));case 3:case"end":return i.stop()}},_callee,this)}));return function get(t){return e.apply(this,arguments)}}()},{key:"values",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee2(){var e,t,n,a=this,i=arguments;return _regenerator["default"].wrap(function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:e=i.length>0&&i[0]!==undefined?i[0]:null;t=i.length>1&&i[1]!==undefined?i[1]:null;if(!(null!==e&&e instanceof P)){o.next=4;break}return o.abrupt("return",e.values(this,t));case 4:e=r.convertKeyRange(e);n=this._backend;return o.abrupt("return",new Promise(function(r,i){var o=[],s=n.transaction([a._tableName],"readonly").objectStore(a._tableName).openCursor(e);s.onsuccess=function(e){var n=e.target.result;if(n){if(null!==t&&o.length>=t){r(o);return}try{o.push(a.decode(n.value,n.primaryKey))}catch(s){i(s)}n["continue"]()}else r(o)};s.onerror=function(){return i(s.error)}}));case 7:case"end":return o.stop()}},_callee2,this)}));return function values(){return e.apply(this,arguments)}}()},{key:"keys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee3(){var e,t,n,a=this,i=arguments;return _regenerator["default"].wrap(function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:e=i.length>0&&i[0]!==undefined?i[0]:null;t=i.length>1&&i[1]!==undefined?i[1]:null;if(!(null!==e&&e instanceof P)){o.next=4;break}return o.abrupt("return",e.keys(this,t));case 4:e=r.convertKeyRange(e);n=this._backend;return o.abrupt("return",new Promise(function(r,i){var o=new Set,s=n.transaction([a._tableName],"readonly").objectStore(a._tableName),u=s.openKeyCursor?s.openKeyCursor(e):s.openCursor(e);u.onsuccess=function(e){var n=e.target.result;if(n){if(null!==t&&o.size>=t){r(o);return}o.add(n.primaryKey);n["continue"]()}else r(o)};u.onerror=function(){return i(u.error)}}));case 7:case"end":return o.stop()}},_callee3,this)}));return function keys(){return e.apply(this,arguments)}}()},{key:"keyStream",value:function keyStream(e){var t=this,n=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;a=r.convertKeyRange(a);var i=this._backend;return new Promise(function(r,o){var s=i.transaction([t._tableName],"readonly").objectStore(t._tableName),u=s.openKeyCursor?s.openKeyCursor(a,n?"next":"prev"):s.openCursor(a,n?"next":"prev");u.onsuccess=function(t){var n=t.target.result;if(n)try{e(n.primaryKey)?n["continue"]():r()}catch(a){o(a)}else r()};u.onerror=function(){return o(u.error)}})}},{key:"valueStream",value:function valueStream(e){var t=this,n=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;a=r.convertKeyRange(a);var i=this._backend;return new Promise(function(r,o){var s=i.transaction([t._tableName],"readonly").objectStore(t._tableName).openCursor(a,n?"next":"prev");s.onsuccess=function(n){var a=n.target.result;if(a)try{e(t.decode(a.value,a.primaryKey),a.primaryKey)?a["continue"]():r()}catch(i){o(i)}else r()};s.onerror=function(){return o(s.error)}})}},{key:"maxValue",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee4(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee4$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);t=this._backend;return i.abrupt("return",new Promise(function(r,a){var i=t.transaction([n._tableName],"readonly").objectStore(n._tableName).openCursor(e,"prev");i.onsuccess=function(e){try{var t=e.target.result;r(t?n.decode(t.value,t.primaryKey):undefined)}catch(i){a(i)}};i.onerror=function(){return a(i.error)}}));case 4:case"end":return i.stop()}},_callee4,this)}));return function maxValue(){return e.apply(this,arguments)}}()},{key:"maxKey",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee5(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee5$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);t=this._backend;return i.abrupt("return",new Promise(function(r,a){var i=t.transaction([n._tableName],"readonly").objectStore(n._tableName),o=i.openKeyCursor?i.openKeyCursor(e,"prev"):i.openCursor(e,"prev");o.onsuccess=function(){return r(o.result?o.result.primaryKey:undefined)};o.onerror=function(){return a(o.error)}}));case 4:case"end":return i.stop()}},_callee5,this)}));return function maxKey(){return e.apply(this,arguments)}}()},{key:"minValue",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee6(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee6$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);t=this._backend;return i.abrupt("return",new Promise(function(r,a){var i=t.transaction([n._tableName],"readonly").objectStore(n._tableName).openCursor(e,"next");i.onsuccess=function(e){try{var t=e.target.result;r(t?n.decode(t.value,t.primaryKey):undefined)}catch(i){a(i)}};i.onerror=function(){return a(i.error)}}));case 4:case"end":return i.stop()}},_callee6,this)}));return function minValue(){return e.apply(this,arguments)}}()},{key:"minKey",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee7(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee7$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);t=this._backend;return i.abrupt("return",new Promise(function(r,a){var i=t.transaction([n._tableName],"readonly").objectStore(n._tableName),o=i.openKeyCursor?i.openKeyCursor(e,"next"):i.openCursor(e,"next");o.onsuccess=function(){return r(o.result?o.result.primaryKey:undefined)};o.onerror=function(){return a(o.error)}}));case 4:case"end":return i.stop()}},_callee7,this)}));return function minKey(){return e.apply(this,arguments)}}()},{key:"count",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee8(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee8$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);t=this._backend;return i.abrupt("return",new Promise(function(r,a){var i;(i=e?t.transaction([n._tableName],"readonly").objectStore(n._tableName).count(e):t.transaction([n._tableName],"readonly").objectStore(n._tableName).count()).onsuccess=function(){return r(i.result)};i.onerror=function(){return a(i.error)}}));case 4:case"end":return i.stop()}},_callee8,this)}));return function count(){return e.apply(this,arguments)}}()},{key:"index",value:function index(e){return this._indices.get(e)}},{key:"_apply",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee9(e){var t,n=this;return _regenerator["default"].wrap(function _callee9$(r){for(;;)switch(r.prev=r.next){case 0:t=this._backend;return r.abrupt("return",new Promise(function(r,a){var i=t.transaction([n._tableName],"readwrite"),o=i.objectStore(n._tableName);e._truncated&&o.clear();var s,u=_createForOfIteratorHelper(e._removed);try{for(u.s();!(s=u.n()).done;){var c=s.value;o["delete"](c)}}catch(p){u.e(p)}finally{u.f()}var l,f=_createForOfIteratorHelper(e._modified);try{for(f.s();!(l=f.n()).done;){var h=(0,_slicedToArray2["default"])(l.value,2),d=h[0],_=h[1];o.put(n.encode(_),d)}}catch(p){f.e(p)}finally{f.f()}i.oncomplete=function(){return r(!0)};i.onerror=a;i.onabort=a}));case 2:case"end":return r.stop()}},_callee9,this)}));return function _apply(t){return e.apply(this,arguments)}}()},{key:"truncate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee10(){var e,t=this;return _regenerator["default"].wrap(function _callee10$(n){for(;;)switch(n.prev=n.next){case 0:e=this._backend;return n.abrupt("return",new Promise(function(n,r){var a=e.transaction([t._tableName],"readonly").objectStore(t._tableName).clear();a.onsuccess=n;a.onerror=function(){return r(a.error)}}));case 2:case"end":return n.stop()}},_callee10,this)}));return function truncate(){return e.apply(this,arguments)}}()},{key:"createIndex",value:function createIndex(e,t){var n=(arguments.length>2&&arguments[2]!==undefined?arguments[2]:{})||{},r=n.multiEntry,a=void 0!==r&&r,i=n.upgradeCondition,s=void 0===i?null:i,u=n.unique,c=void 0!==u&&u;if(this._db.connected)throw new Error("Cannot create index while connected");var l=new o(this,e,t=t||e,a,c);this._indices.set(e,l);this._indicesToCreate.set(e,{index:l,upgradeCondition:s})}},{key:"deleteIndex",value:function deleteIndex(e){var t=((arguments.length>1&&arguments[1]!==undefined?arguments[1]:{})||{}).upgradeCondition,n=void 0===t?null:t;if(this._db.connected)throw new Error("Cannot delete index while connected");this._indicesToDelete.push({indexName:e,upgradeCondition:n})}},{key:"close",value:function close(){return this._db.close()}},{key:"applyCombined",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee11(e){var t,n,r,a,i,o,s,u,c;return _regenerator["default"].wrap(function _callee11$(l){for(;;)switch(l.prev=l.next){case 0:t=new T(this._tableName);e._truncated&&t.truncate();n=_createForOfIteratorHelper(e._removed);try{for(n.s();!(r=n.n()).done;){a=r.value;t.remove(a)}}catch(f){n.e(f)}finally{n.f()}i=_createForOfIteratorHelper(e._modified);try{for(i.s();!(o=i.n()).done;){s=(0,_slicedToArray2["default"])(o.value,2),u=s[0],c=s[1];t.put(u,this.encode(c))}}catch(f){i.e(f)}finally{i.f()}return l.abrupt("return",t);case 7:case"end":return l.stop()}},_callee11,this)}));return function applyCombined(t){return e.apply(this,arguments)}}()},{key:"isSynchronous",value:function isSynchronous(){return!1}},{key:"connected",get:function get(){return this._db.connected}},{key:"_backend",get:function get(){if(!this.connected)throw new Error("Requires a connected database");return this._db.backend}},{key:"indices",get:function get(){return this._indices}},{key:"backend",get:function get(){return this._db.backend}},{key:"tableName",get:function get(){return this._tableName}}]);return IDBBackend}();t.register(a);var i=function(){function JungleDB(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};(0,_classCallCheck2["default"])(this,JungleDB);if(t<=0)throw new Error("The version provided must not be less or equal to 0");this._databaseDir=e;this._dbVersion=t;this._oldDbVersion=null;this._onUpgradeNeeded=n.onUpgradeNeeded;this._connected=!1;this._objectStores=new Map;this._objectStoreBackends=new Map;this._objectStoresToDelete=[]}(0,_createClass2["default"])(JungleDB,[{key:"connect",value:function connect(){if(this._db)return Promise.resolve(this._db);var e=this._indexedDB.open(this._databaseDir,this._dbVersion),t=this;return new Promise(function(n,r){e.onsuccess=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee12(){return _regenerator["default"].wrap(function _callee12$(r){for(;;)switch(r.prev=r.next){case 0:t._connected=!0;t._db=e.result;if(null===t._oldDbVersion||!t._onUpgradeNeeded){r.next=5;break}r.next=5;return t._onUpgradeNeeded(t._oldDbVersion,t._dbVersion,t);case 5:n(e.result);case 6:case"end":return r.stop()}},_callee12)}));e.onerror=r;e.onupgradeneeded=function(n){return t._initDB(n,e)}})}},{key:"_initDB",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee13(e,t){var n,r,a,i,o,s,u,c,l,f,h,d,_,p;return _regenerator["default"].wrap(function _callee13$(y){for(;;)switch(y.prev=y.next){case 0:n=e.target.result;r=_createForOfIteratorHelper(this._objectStoresToDelete);try{for(r.s();!(a=r.n()).done;){i=a.value,o=i.tableName,s=i.upgradeCondition;n.objectStoreNames.contains(o)&&(null===s||!0===s||"function"==typeof s&&s(e.oldVersion,e.newVersion))&&n.deleteObjectStore(o)}}catch(v){r.e(v)}finally{r.f()}this._objectStoresToDelete=[];u=_createForOfIteratorHelper(this._objectStoreBackends);try{for(u.s();!(c=u.n()).done;){l=(0,_slicedToArray2["default"])(c.value,2),f=l[0],h=l[1],d=h.backend,_=h.upgradeCondition;p=void 0;p=!n.objectStoreNames.contains(f)&&(null===_||!0===_||"function"==typeof _&&_(e.oldVersion,e.newVersion))?n.createObjectStore(f):t.transaction.objectStore(f);d.init(p,e.oldVersion,e.newVersion)}}catch(v){u.e(v)}finally{u.f()}this._oldDbVersion=e.oldVersion;this._objectStoreBackends.clear();case 8:case"end":return y.stop()}},_callee13,this)}));return function _initDB(t,n){return e.apply(this,arguments)}}()},{key:"getObjectStore",value:function getObjectStore(e){return this._objectStores.get(e)}},{key:"createObjectStore",value:function createObjectStore(e){var t=(arguments.length>1&&arguments[1]!==undefined?arguments[1]:{})||{},n=t.codec,r=void 0===n?null:n,i=t.persistent,o=void 0===i||i,s=t.upgradeCondition,u=void 0===s?null:s,c=t.enableLruCache,l=void 0===c||c,f=t.lruCacheSize,h=void 0===f?O.MAX_CACHE_SIZE:f,d=t.rawLruCacheSize,_=void 0===d?0:d;if(this._connected)throw new Error("Cannot create ObjectStore while connected");if(this._objectStores.has(e))return this._objectStores.get(e);var p=null,y=p=o?new a(this,e,r):new j(e,r);o&&l&&(y=new O(p,h,_));var v=new B(y,this,e);this._objectStores.set(e,v);this._objectStoreBackends.set(e,{backend:p,upgradeCondition:u});return v}},{key:"deleteObjectStore",value:function deleteObjectStore(e){var t=((arguments.length>1&&arguments[1]!==undefined?arguments[1]:{})||{}).upgradeCondition,n=void 0===t?null:t;if(this._connected)throw new Error("Cannot delete ObjectStore while connected");this._objectStoresToDelete.push({tableName:e,upgradeCondition:n})}},{key:"close",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee14(){return _regenerator["default"].wrap(function _callee14$(e){for(;;)switch(e.prev=e.next){case 0:if(this._connected){this._connected=!1;this.backend.close()}case 1:case"end":return e.stop()}},_callee14,this)}));return function close(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee15(){var e=this;return _regenerator["default"].wrap(function _callee15$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this.close();case 2:return t.abrupt("return",new Promise(function(t,n){var r=e._indexedDB.deleteDatabase(e._databaseDir);r.onsuccess=t;r.onerror=n}));case 3:case"end":return t.stop()}},_callee15,this)}));return function destroy(){return e.apply(this,arguments)}}()},{key:"toString",value:function toString(){return"JungleDB{name=".concat(this._databaseDir,"}")}},{key:"_indexedDB",get:function get(){return window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB}},{key:"backend",get:function get(){return this._db}},{key:"connected",get:function get(){return this._connected}}],[{key:"createVolatileObjectStore",value:function createVolatileObjectStore(){var e=((arguments.length>0&&arguments[0]!==undefined?arguments[0]:{})||{}).codec;return new B(new j("",void 0===e?null:e),null)}},{key:"commitCombined",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee16(e,t){var n,r,a,i,o,s,u,c,l,f,h,d,_,p,y,v,g=arguments;return _regenerator["default"].wrap(function _callee16$(k){for(;;)switch(k.prev=k.next){case 0:if(!(e instanceof K)){k.next=11;break}n=[];r=[];a=[];k.next=6;return Promise.all(e.transactions.map(function(e){return e.objectStore._backend.applyCombined(e)}));case 6:i=k.sent;o=_createForOfIteratorHelper(i);try{for(o.s();!(s=o.n()).done;){u=s.value;c=u;Array.isArray(u)||(c=[u]);l=_createForOfIteratorHelper(c);try{for(l.s();!(f=l.n()).done;)if("function"==typeof(h=f.value))n.push(h);else{r.push(h);a.push(h.tableName)}}catch(m){l.e(m)}finally{l.f()}}}catch(m){o.e(m)}finally{o.f()}d=null!==e.backend?e.backend.backend:null;return k.abrupt("return",new Promise(function(e,t){if(a.length>0){var i,o=d.transaction(a,"readwrite"),s=_createForOfIteratorHelper(r);try{for(s.s();!(i=s.n()).done;){var u=i.value,c=o.objectStore(u.tableName);u.truncated&&c.clear();var l,f=_createForOfIteratorHelper(u.removed);try{for(f.s();!(l=f.n()).done;){var h=l.value;c["delete"](h)}}catch(m){f.e(m)}finally{f.f()}var _,p=_createForOfIteratorHelper(u.modified);try{for(p.s();!(_=p.n()).done;){var y=(0,_slicedToArray2["default"])(_.value,2),v=y[0],g=y[1];c.put(g,v)}}catch(m){p.e(m)}finally{p.f()}}}catch(m){s.e(m)}finally{s.f()}o.oncomplete=function(){Promise.all(n.map(function(e){return e()})).then(function(){e(!0)})};o.onerror=t;o.onabort=t}else Promise.all(n.map(function(e){return e()})).then(function(){e(!0)})}));case 11:for(_=g.length,p=new Array(_>2?_-2:0),y=2;y<_;y++)p[y-2]=g[y];p.push(e);p.push(t);if(p.every(function(e){return e instanceof R})){k.next=16;break}throw new Error("Invalid arguments supplied");case 16:v=(0,_construct2["default"])(K,p);return k.abrupt("return",v.commit());case 18:case"end":return k.stop()}},_callee16)}));return function commitCombined(t,n){return e.apply(this,arguments)}}()}]);return JungleDB}();i.JSON_ENCODING={};i.BINARY_ENCODING={};i.STRING_ENCODING={};i.NUMBER_ENCODING={};i.GENERIC_ENCODING={};t.register(i);var o=function(){function PersistentIndex(e,t,n){var r=arguments.length>3&&arguments[3]!==undefined&&arguments[3],a=arguments.length>4&&arguments[4]!==undefined&&arguments[4];(0,_classCallCheck2["default"])(this,PersistentIndex);this._objectStore=e;this._indexName=t;this._keyPath=n;this._multiEntry=r;this._unique=a}(0,_createClass2["default"])(PersistentIndex,[{key:"truncate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee17(){return _regenerator["default"].wrap(function _callee17$(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},_callee17)}));return function truncate(){return e.apply(this,arguments)}}()},{key:"_index",value:function _index(e){return e.transaction([this._objectStore.tableName],"readonly").objectStore(this._objectStore.tableName).index(this._indexName)}},{key:"values",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee18(){var e,t,n,a=this,i=arguments;return _regenerator["default"].wrap(function _callee18$(o){for(;;)switch(o.prev=o.next){case 0:e=i.length>0&&i[0]!==undefined?i[0]:null;t=i.length>1&&i[1]!==undefined?i[1]:null;e=r.convertKeyRange(e);o.next=5;return this._objectStore.backend;case 5:n=o.sent;return o.abrupt("return",new Promise(function(r,i){var o=[],s=a._index(n).openCursor(e);s.onsuccess=function(e){var n=e.target.result;if(n){if(null!==t&&o.length>=t){r(o);return}try{o.push(a._objectStore.decode(n.value,n.primaryKey))}catch(s){i(s)}n["continue"]()}else r(o)};s.onerror=function(){return i(s.error)}}));case 7:case"end":return o.stop()}},_callee18,this)}));return function values(){return e.apply(this,arguments)}}()},{key:"keys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee19(){var e,t,n,a=this,i=arguments;return _regenerator["default"].wrap(function _callee19$(o){for(;;)switch(o.prev=o.next){case 0:e=i.length>0&&i[0]!==undefined?i[0]:null;t=i.length>1&&i[1]!==undefined?i[1]:null;e=r.convertKeyRange(e);o.next=5;return this._objectStore.backend;case 5:n=o.sent;return o.abrupt("return",new Promise(function(r,i){var o=new Set,s=a._index(n),u=s.openKeyCursor?s.openKeyCursor(e):s.openCursor(e);u.onsuccess=function(e){var n=e.target.result;if(n){if(null!==t&&o.size>=t){r(o);return}o.add(n.primaryKey);n["continue"]()}else r(o)};u.onerror=function(){return i(u.error)}}));case 7:case"end":return o.stop()}},_callee19,this)}));return function keys(){return e.apply(this,arguments)}}()},{key:"maxValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee20(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee20$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);i.next=4;return this._objectStore.backend;case 4:t=i.sent;return i.abrupt("return",new Promise(function(r,a){var i=[],o=null,s=n._index(t).openCursor(e,"prev");s.onsuccess=function(e){var t=e.target.result;t&&null===o&&(o=t.key);if(t&&y.equals(o,t.key)){try{i.push(n._objectStore.decode(t.value,t.primaryKey))}catch(s){a(s)}t["continue"]()}else r(i)};s.onerror=function(){return a(s.error)}}));case 6:case"end":return i.stop()}},_callee20,this)}));return function maxValues(){return e.apply(this,arguments)}}()},{key:"maxKeys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee21(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee21$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);i.next=4;return this._objectStore.backend;case 4:t=i.sent;return i.abrupt("return",new Promise(function(r,a){var i=new Set,o=null,s=n._index(t),u=s.openKeyCursor?s.openKeyCursor(e,"prev"):s.openCursor(e,"prev");u.onsuccess=function(e){var t=e.target.result;t&&null===o&&(o=t.key);if(t&&y.equals(o,t.key)){i.add(t.primaryKey);t["continue"]()}else r(i)};u.onerror=function(){return a(u.error)}}));case 6:case"end":return i.stop()}},_callee21,this)}));return function maxKeys(){return e.apply(this,arguments)}}()},{key:"minValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee22(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee22$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);i.next=4;return this._objectStore.backend;case 4:t=i.sent;return i.abrupt("return",new Promise(function(r,a){var i=[],o=null,s=n._index(t).openCursor(e,"next");s.onsuccess=function(e){var t=e.target.result;t&&null===o&&(o=t.key);if(t&&y.equals(o,t.key)){try{i.push(n._objectStore.decode(t.value,t.primaryKey))}catch(s){a(s)}t["continue"]()}else r(i)};s.onerror=function(){return a(s.error)}}));case 6:case"end":return i.stop()}},_callee22,this)}));return function minValues(){return e.apply(this,arguments)}}()},{key:"minKeys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee23(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee23$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);i.next=4;return this._objectStore.backend;case 4:t=i.sent;return i.abrupt("return",new Promise(function(r,a){var i=new Set,o=null,s=n._index(t),u=s.openKeyCursor?s.openKeyCursor(e,"next"):s.openCursor(e,"next");u.onsuccess=function(e){var t=e.target.result;t&&null===o&&(o=t.key);if(t&&y.equals(o,t.key)){i.add(t.primaryKey);t["continue"]()}else r(i)};u.onerror=function(){return a(u.error)}}));case 6:case"end":return i.stop()}},_callee23,this)}));return function minKeys(){return e.apply(this,arguments)}}()},{key:"keyStream",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee24(e){var t,n,a,i=this,o=arguments;return _regenerator["default"].wrap(function _callee24$(s){for(;;)switch(s.prev=s.next){case 0:t=!(o.length>1&&o[1]!==undefined)||o[1];n=o.length>2&&o[2]!==undefined?o[2]:null;n=r.convertKeyRange(n);s.next=5;return this._objectStore.backend;case 5:a=s.sent;return s.abrupt("return",new Promise(function(r,o){var s=i._index(a),u=s.openKeyCursor?s.openKeyCursor(n,t?"next":"prev"):s.openCursor(n,t?"next":"prev");u.onsuccess=function(t){var n=t.target.result;if(n)try{e(n.primaryKey)?n["continue"]():r()}catch(a){o(a)}else r()};u.onerror=function(){return o(u.error)}}));case 7:case"end":return s.stop()}},_callee24,this)}));return function keyStream(t){return e.apply(this,arguments)}}()},{key:"valueStream",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee25(e){var t,n,a,i=this,o=arguments;return _regenerator["default"].wrap(function _callee25$(s){for(;;)switch(s.prev=s.next){case 0:t=!(o.length>1&&o[1]!==undefined)||o[1];n=o.length>2&&o[2]!==undefined?o[2]:null;n=r.convertKeyRange(n);s.next=5;return this._objectStore.backend;case 5:a=s.sent;return s.abrupt("return",new Promise(function(r,o){var s=i._index(a).openCursor(n,t?"next":"prev");s.onsuccess=function(t){var n=t.target.result;if(n)try{e(i._objectStore.decode(n.value,n.primaryKey),n.primaryKey)?n["continue"]():r()}catch(a){o(a)}else r()};s.onerror=function(){return o(s.error)}}));case 7:case"end":return s.stop()}},_callee25,this)}));return function valueStream(t){return e.apply(this,arguments)}}()},{key:"count",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee26(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee26$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);i.next=4;return this._objectStore.backend;case 4:t=i.sent;return i.abrupt("return",new Promise(function(r,a){var i;(i=e?n._index(t).count(e):n._index(t).count()).onsuccess=function(){return r(i.result)};i.onerror=function(){return a(i.error)}}));case 6:case"end":return i.stop()}},_callee26,this)}));return function count(){return e.apply(this,arguments)}}()},{key:"keyPath",get:function get(){return this._keyPath}},{key:"multiEntry",get:function get(){return this._multiEntry}},{key:"unique",get:function get(){return this._unique}}]);return PersistentIndex}();t.register(o);Object.defineProperty(Array.prototype,"iterator",{value:function value(){var e=this,t=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0],n=t?0:this.length-1;return{next:function next(){return n>=0&&n<e.length?e[t?n++:n--]:undefined},hasNext:function hasNext(){return n>=0&&n<e.length},peek:function peek(){return n>=0&&n<e.length?e[n]:undefined}}}});var s=function(){function Node(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];(0,_classCallCheck2["default"])(this,Node);this._keys=e}(0,_createClass2["default"])(Node,[{key:"keys",get:function get(){return this._keys}}]);return Node}();t.register(s);var u=function(e){(0,_inherits2["default"])(LeafNode,e);var t=_createSuper(LeafNode);function LeafNode(){var e,n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[],r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];(0,_classCallCheck2["default"])(this,LeafNode);if(n.length!==r.length)throw new Error("Keys and records must have the same length");(e=t.call(this,n))._records=r;e.prevLeaf=null;e.nextLeaf=null;return e}(0,_createClass2["default"])(LeafNode,[{key:"isLeaf",value:function isLeaf(){return!0}},{key:"getItem",value:function getItem(e,t){var n=this._keys;if(t===l.NEAR_MODE.GE){for(var r=0,a=n.length;r<a;++r)if(y.compare(e,n[r])<=0)return r}else if(t===l.NEAR_MODE.LE){for(var i=n.length-1;i>=0;--i)if(y.compare(e,n[i])>=0)return i}else for(var o=0,s=n.length;o<s;++o)if(y.equals(e,n[o]))return o;return-1}},{key:"addKey",value:function addKey(e,t){for(var n=this._keys.length,r=0,a=n;r<a;++r){if(y.equals(e,this._keys[r]))return-1;if(y.compare(e,this._keys[r])<=0){n=r;break}}this._keys.splice(n,0,e);this._records.splice(n,0,t);return n}},{key:"split",value:function split(){for(var e=Math.floor(this._keys.length/2),t=[],n=[],r=0;r<e;++r){t.unshift(this._keys.pop());n.unshift(this._records.pop())}var a=new LeafNode(t,n);a.prevLeaf=this;a.nextLeaf=this.nextLeaf;null!==this.nextLeaf&&(this.nextLeaf.prevLeaf=a);this.nextLeaf=a;return a}},{key:"merge",value:function merge(e,t,n){for(var r=0,a=e.keys.length;r<a;++r){this._keys.push(e.keys[r]);this._records.push(e.records[r])}this.nextLeaf=e.nextLeaf;null!==e.nextLeaf&&(e.nextLeaf.prevLeaf=this);e.prevLeaf=null;e.nextLeaf=null;for(var i=t.keys.length-1,o=i;o>=0;--o)if(y.equals(t.keys[o],n)){i=o;break}t.keys.splice(i,1);t.nodePointers.splice(i+1,1)}},{key:"records",get:function get(){return this._records}}]);return LeafNode}(s);t.register(u);var c=function(e){(0,_inherits2["default"])(InnerNode,e);var t=_createSuper(InnerNode);function InnerNode(){var e,n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[],r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];(0,_classCallCheck2["default"])(this,InnerNode);(e=t.call(this,n))._nodePointers=r;return e}(0,_createClass2["default"])(InnerNode,[{key:"isLeaf",value:function isLeaf(){return!1}},{key:"getItem",value:function getItem(e){for(var t=this._keys.length,n=0;n<t;++n)if(e<this._keys[n])return n;return this._keys.length}},{key:"addKey",value:function addKey(e,t,n){for(var r=this._keys.length,a=r,i=0;i<r;++i)if(y.compare(e,this._keys[i])<=0){a=i;break}this._keys.splice(a,0,e);this._nodePointers.splice(a,0,t);this._nodePointers[a+1]=n}},{key:"split",value:function split(){for(var e=Math.ceil(this._keys.length/2)-1,t=[this._nodePointers.pop()],n=[],r=e-1;r>=0;--r){n.unshift(this._keys.pop());t.unshift(this._nodePointers.pop())}return new InnerNode(n,t)}},{key:"merge",value:function merge(e,t,n){var r=t.keys[n];this._keys.push(r);for(var a=0,i=e.keys.length;a<i;++a){this._keys.push(e.keys[a]);this._nodePointers.push(e.nodePointers[a])}this._nodePointers.push(e.nodePointers[e.nodePointers.length-1]);t.keys.splice(n,1);t.nodePointers.splice(n+1,1);return r}},{key:"nodePointers",get:function get(){return this._nodePointers}}]);return InnerNode}(s);t.register(c);var l=function(){function BTree(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:7;(0,_classCallCheck2["default"])(this,BTree);this._root=new u;this._maxkey=e-1;this._minkyl=Math.floor(e/2);this._minkyn=Math.floor(this._maxkey/2);this._leaf=null;this._item=-1;this._key=null;this._record=null;this._length=0;this._eof=!0;this._found=!1}(0,_createClass2["default"])(BTree,[{key:"insert",value:function insert(e,t){var n=[];this._leaf=this._root;for(;!this._leaf.isLeaf();){n.push(this._leaf);this._item=this._leaf.getItem(e);this._leaf=this._leaf.nodePointers[this._item]}this._item=this._leaf.addKey(e,t);this._key=e;this._eof=!1;if(-1===this._item){this._found=!0;this._item=this._leaf.getItem(e,!1);this._record=this._leaf.records[this._item]}else{this._found=!1;this._record=t;this._length++;if(this._leaf.keys.length>this._maxkey){var r=this._leaf,a=this._leaf.split(),i=a.keys[0];this._item=this._leaf.getItem(e,!1);if(-1===this._item){this._leaf=this._leaf.nextLeaf;this._item=this._leaf.getItem(e,!1)}for(;;){if(0===n.length){var o=new c;o.keys[0]=i;o.nodePointers[0]=r;o.nodePointers[1]=a;this._root=o;break}var s=n.pop();s.addKey(i,r,a);if(s.keys.length<=this._maxkey)break;r=s;a=s.split();i=s.keys.pop()}}}return!this._found}},{key:"remove",value:function remove(e){if("undefined"==typeof e){if(-1===this._item){this._eof=!0;this._found=!1;return!1}e=this._leaf.keys[this._item]}this._del(e);if(this._found){this.seek(e,BTree.NEAR_MODE.GE);this._found=!0}else{this._item=-1;this._eof=!0;this._key=null;this._record=null}return this._found}},{key:"seek",value:function seek(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:BTree.NEAR_MODE.NONE;this._leaf=this._root;for(;!this._leaf.isLeaf();){this._item=this._leaf.getItem(e);this._leaf=this._leaf.nodePointers[this._item]}this._item=this._leaf.getItem(e,t);if(t===BTree.NEAR_MODE.GE&&-1===this._item&&null!==this._leaf.nextLeaf){this._leaf=this._leaf.nextLeaf;this._item=0}if(t===BTree.NEAR_MODE.LE&&-1===this._item&&null!==this._leaf.prevLeaf){this._leaf=this._leaf.prevLeaf;this._item=this._leaf.records.length-1}if(-1===this._item){this._eof=!0;this._key=null;this._found=!1;this._record=null}else{this._eof=!1;this._found=this._leaf.keys[this._item]===e;this._key=this._leaf.keys[this._item];this._record=this._leaf.records[this._item]}return!this._eof}},{key:"skip",value:function skip(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;"number"!=typeof e&&(e=1);-1!==this._item&&null!==this._leaf||(this._eof=!0);if(e>0){for(;!this._eof&&this._leaf.keys.length-this._item-1<e;){e=e-this._leaf.keys.length+this._item;this._leaf=this._leaf.nextLeaf;null===this._leaf?this._eof=!0:this._item=0}this._eof||(this._item=this._item+e)}else{e=-e;for(;!this._eof&&this._item<e;){e=e-this._item-1;this._leaf=this._leaf.prevLeaf;null===this._leaf?this._eof=!0:this._item=this._leaf.keys.length-1}this._eof||(this._item=this._item-e)}if(this._eof){this._item=-1;this._found=!1;this._key=null;this._record=null}else{this._found=!0;this._key=this._leaf.keys[this._item];this._record=this._leaf.records[this._item]}return this._found}},{key:"goto",value:function goto(e){if(e<0){this.goBottom();this._eof||this.skip(e+1)}else{this.goTop();this._eof||this.skip(e-1)}return this._found}},{key:"keynum",value:function keynum(){if(null===this._leaf||-1===this._item)return-1;for(var e=this._item+1,t=this._leaf;null!==t.prevLeaf;)e+=(t=t.prevLeaf).keys.length;return e}},{key:"goTop",value:function goTop(){this._leaf=this._root;for(;!this._leaf.isLeaf();)this._leaf=this._leaf.nodePointers[0];if(0===this._leaf.keys.length){this._item=-1;this._eof=!0;this._found=!1;this._key=null;this._record=null}else{this._item=0;this._eof=!1;this._found=!0;this._key=this._leaf.keys[0];this._record=this._leaf.records[0]}return this._found}},{key:"goBottom",value:function goBottom(){this._leaf=this._root;for(;!this._leaf.isLeaf();)this._leaf=this._leaf.nodePointers[this._leaf.nodePointers.length-1];if(0===this._leaf.keys.length){this._item=-1;this._eof=!0;this._found=!1;this._key=null;this._record=null}else{this._item=this._leaf.keys.length-1;this._eof=!1;this._found=!0;this._key=this._leaf.keys[this._item];this._record=this._leaf.records[this._item]}return this._found}},{key:"pack",value:function pack(){var e,t;this.goTop(0);if(this._leaf===this._root)return!1;for(var n=new u,r=0,a=this._leaf,i=0,o=[],s=[];;){n.keys[r]=a.keys[i];n.records[r]=a.records[i];0===r&&s.push(n);if(i===a.keys.length-1){if(null===a.nextLeaf)break;a=a.nextLeaf;i=0}else i++;if(r===this._maxkey-1){var l=new u;n.nextLeaf=l;l.prevLeaf=n;n=l;r=0}else r++}var f,h,d=this._minkyl-n.keys.length;a=n.prevLeaf;if(d>0&&null!==a)for(t=d-1;t>=0;--t){n.keys.unshift(a.keys.pop());n.records.unshift(a.records.pop())}for(t=1,e=s.length;t<e;++t)o.push(s[t].keys[0]);o[o.length]=null;for(;null!==o[0];){f=o;h=s;o=[];s=[];r=this._maxkey+1;t=0;e=f.length;for(;t<e;t++){if(r>this._maxkey){n=new c;r=0;s.push(n)}n.keys[r]=f[t];n.nodePointers[r]=h[t];r++}if((d=this._minkyn-n.keys.length+1)>0&&s.length>1){a=s[s.length-2];for(t=d-1;t>=0;--t){n.keys.unshift(a.keys.pop());n.nodePointers.unshift(a.nodePointers.pop())}}t=0;e=s.length;for(;t<e;++t)o.push(s[t].keys.pop())}this._root=s[0];this.goTop();return this._found}},{key:"_del",value:function _del(e){var t=[],n=null,r=-1;this._leaf=this._root;for(;!this._leaf.isLeaf();){t.push(this._leaf);n=this._leaf;r=this._leaf.getItem(e);this._leaf=this._leaf.nodePointers[r]}this._item=this._leaf.getItem(e,!1);if(-1!==this._item){this._found=!0;this._leaf.keys.splice(this._item,1);this._leaf.records.splice(this._item,1);this._length--;if(this._leaf!==this._root)if(this._leaf.keys.length>=this._minkyl)0===this._item&&BTree._fixNodes(t,e,this._leaf.keys[0]);else{var a,i=0===r?null:n.nodePointers[r-1];if(null!==i&&i.keys.length>this._minkyl){a=0===this._item?e:this._leaf.keys[0];this._leaf.keys.unshift(i.keys.pop());this._leaf.records.unshift(i.records.pop());BTree._fixNodes(t,a,this._leaf.keys[0])}else{var o=r===n.keys.length?null:n.nodePointers[r+1];if(null!==o&&o.keys.length>this._minkyl){this._leaf.keys.push(o.keys.shift());this._leaf.records.push(o.records.shift());0===this._item&&BTree._fixNodes(t,e,this._leaf.keys[0]);BTree._fixNodes(t,this._leaf.keys[this._leaf.keys.length-1],o.keys[0])}else{if(null!==i){a=0===this._item?e:this._leaf.keys[0];i.merge(this._leaf,n,a);this._leaf=i}else{a=o.keys[0];this._leaf.merge(o,n,a);0===this._item&&BTree._fixNodes(t,e,this._leaf.keys[0])}if(1!==t.length||0!==n.keys.length)for(var s,u=t.pop();u.keys.length<this._minkyn&&t.length>0;){if(null!==(o=(s=(n=t.pop()).getItem(a))===n.keys.length?null:n.nodePointers[s+1])&&o.keys.length>this._minkyn){u.keys.push(n.keys[s]);n.keys[s]=o.keys.shift();u.nodePointers.push(o.nodePointers.shift());break}if(null!==(i=0===s?null:n.nodePointers[s-1])&&i.keys.length>this._minkyn){u.keys.unshift(n.keys[s-1]);n.keys[s-1]=i.keys.pop();u.nodePointers.unshift(i.nodePointers.pop());break}if(null!==i){a=i.merge(u,n,s-1);u=i}else null!==o&&(a=u.merge(o,n,s));if(0===t.length&&0===n.keys.length){this._root=u;break}u=n}else this._root=this._leaf}}}}else this._found=!1}},{key:"goToLowerBound",value:function goToLowerBound(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1];if(e!==undefined){var n=this.seek(e,BTree.NEAR_MODE.GE);n&&t&&y.equals(e,this.currentKey)&&(n=this.skip());return n}return this.goTop()}},{key:"goToUpperBound",value:function goToUpperBound(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1];if(e!==undefined){var n=this.seek(e,BTree.NEAR_MODE.LE);n&&t&&y.equals(e,this.currentKey)&&(n=this.skip(-1));return n}return this.goBottom()}},{key:"length",get:function get(){return this._length}},{key:"currentKey",get:function get(){return this._key}},{key:"currentRecord",get:function get(){return this._record}}],[{key:"_fixNodes",value:function _fixNodes(e,t,n){var r,a=e.length,i=!0;do{for(var o=(r=e[--a].keys).length-1;o>=0;--o)if(r[o]===t){r[o]=n;i=!1;break}}while(i&&a>0)}}]);return BTree}();l.NEAR_MODE={NONE:0,LE:1,GE:2};t.register(l);var f=function(){function BufferUtils(){(0,_classCallCheck2["default"])(this,BufferUtils)}(0,_createClass2["default"])(BufferUtils,null,[{key:"_codePointTextDecoder",value:function _codePointTextDecoder(e){if("undefined"==typeof TextDecoder)throw new Error("TextDecoder not supported");if(null===BufferUtils._ISO_8859_15_DECODER)throw new Error("TextDecoder does not supprot iso-8859-15");if(BufferUtils._ISO_8859_15_DECODER===undefined)try{BufferUtils._ISO_8859_15_DECODER=new TextDecoder("iso-8859-15")}finally{BufferUtils._ISO_8859_15_DECODER=null}return BufferUtils._ISO_8859_15_DECODER.decode(e).replace("€","¤").replace("Š","¦").replace("š","¨").replace("Ž","´").replace("ž","¸").replace("Œ","¼").replace("œ","½").replace("Ÿ","¾")}},{key:"_tripletToBase64",value:function _tripletToBase64(e){return BufferUtils._BASE64_LOOKUP[e>>18&63]+BufferUtils._BASE64_LOOKUP[e>>12&63]+BufferUtils._BASE64_LOOKUP[e>>6&63]+BufferUtils._BASE64_LOOKUP[63&e]}},{key:"_base64encodeChunk",value:function _base64encodeChunk(e,t,n){for(var r,a=[],i=t;i<n;i+=3){r=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]);a.push(BufferUtils._tripletToBase64(r))}return a.join("")}},{key:"_base64fromByteArray",value:function _base64fromByteArray(e){for(var t,n=e.length,r=n%3,a="",i=[],o=0,s=n-r;o<s;o+=16383)i.push(BufferUtils._base64encodeChunk(e,o,o+16383>s?s:o+16383));if(1===r){t=e[n-1];a+=BufferUtils._BASE64_LOOKUP[t>>2];a+=BufferUtils._BASE64_LOOKUP[t<<4&63];a+="=="}else if(2===r){t=(e[n-2]<<8)+e[n-1];a+=BufferUtils._BASE64_LOOKUP[t>>10];a+=BufferUtils._BASE64_LOOKUP[t>>4&63];a+=BufferUtils._BASE64_LOOKUP[t<<2&63];a+="="}i.push(a);return i.join("")}},{key:"toBase64",value:function toBase64(e){if("undefined"!=typeof Buffer&&"undefined"==typeof window)return Buffer.from(e).toString("base64");if("undefined"!=typeof TextDecoder&&null!==BufferUtils._ISO_8859_15_DECODER)try{return btoa(BufferUtils._codePointTextDecoder(new Uint8Array(e)))}catch(t){}return BufferUtils._base64fromByteArray(new Uint8Array(e))}},{key:"fromBase64",value:function fromBase64(e){if(!/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e))throw new Error("Invalid base64");return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})}},{key:"toBase64lex",value:function toBase64lex(e){for(var t=BufferUtils.toBase64(e),n="",r=0;r<t.length;r++)n+=BufferUtils.BASE64_TO_BASE64_LEX[t[r]];return n}},{key:"fromBase64lex",value:function fromBase64lex(e){for(var t="",n=0;n<e.length;n++)t+=BufferUtils.BASE64_LEX_TO_BASE64[e[n]];return BufferUtils.fromBase64(t)}},{key:"equals",value:function equals(e,t){if(e.length!==t.length)return!1;for(var n=new Uint8Array(e),r=new Uint8Array(t),a=0;a<e.length;a++)if(n[a]!==r[a])return!1;return!0}},{key:"compare",value:function compare(e,t){if(e.length<t.length)return-1;if(e.length>t.length)return 1;for(var n=0;n<e.length;n++){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}return 0}}]);return BufferUtils}();f.BASE64_ALPHABET="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";f._BASE64_LOOKUP=[];for(var h=0,d=f.BASE64_ALPHABET.length;h<d;++h)f._BASE64_LOOKUP[h]=f.BASE64_ALPHABET[h];f.BASE64_LEX_ALPHABET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~";f.BASE64_TO_BASE64_LEX={"=":"-"};f.BASE64_LEX_TO_BASE64={"-":"="};for(var _=0,p=f.BASE64_ALPHABET.length;_<p;++_){f.BASE64_TO_BASE64_LEX[f.BASE64_ALPHABET[_]]=f.BASE64_LEX_ALPHABET[_];f.BASE64_LEX_TO_BASE64[f.BASE64_LEX_ALPHABET[_]]=f.BASE64_ALPHABET[_]}t.register(f);var y=function(){function ComparisonUtils(){(0,_classCallCheck2["default"])(this,ComparisonUtils)}(0,_createClass2["default"])(ComparisonUtils,null,[{key:"equals",value:function equals(e,t){return e===t||(e instanceof Set&&t instanceof Set?e.equals(t):!(!ComparisonUtils.isUint8Array(e)||!ComparisonUtils.isUint8Array(t))&&f.equals(new Uint8Array(e),new Uint8Array(t)))}},{key:"compare",value:function compare(e,t){return ComparisonUtils.isUint8Array(e)&&ComparisonUtils.isUint8Array(t)?f.compare(new Uint8Array(e),new Uint8Array(t)):e<t?-1:e>t?1:0}},{key:"isUint8Array",value:function isUint8Array(e){return"undefined"!=typeof Buffer&&"undefined"==typeof window&&e instanceof Buffer||(ArrayBuffer.isView(e)||e instanceof ArrayBuffer)}}]);return ComparisonUtils}();t.register(y);var v=function(){function JSONUtils(){(0,_classCallCheck2["default"])(this,JSONUtils)}(0,_createClass2["default"])(JSONUtils,null,[{key:"stringify",value:function stringify(e){return JSON.stringify(e,JSONUtils.jsonifyType)}},{key:"parse",value:function parse(e){return JSON.parse(e,JSONUtils.parseType)}},{key:"parseType",value:function parseType(e,t){if(t&&t[JSONUtils.TYPE_SYMBOL])switch(t[JSONUtils.TYPE_SYMBOL]){case"Uint8Array":return f.fromBase64(t[JSONUtils.VALUE_SYMBOL]);case"Set":return Set.from(t[JSONUtils.VALUE_SYMBOL])}return t}},{key:"jsonifyType",value:function jsonifyType(e,t){return t instanceof Uint8Array?JSONUtils.typedObject("Uint8Array",f.toBase64(t)):t instanceof Set?JSONUtils.typedObject("Set",Array.from(t)):t}},{key:"typedObject",value:function typedObject(e,t){var n={};n[JSONUtils.TYPE_SYMBOL]=e;n[JSONUtils.VALUE_SYMBOL]=t;return n}}]);return JSONUtils}();v.TYPE_SYMBOL="__";v.VALUE_SYMBOL="value";t.register(v);var g=function(){(0,_createClass2["default"])(Log,null,[{key:"instance",get:function get(){Log._instance||(Log._instance=new Log(new n));return Log._instance}}]);function Log(e){(0,_classCallCheck2["default"])(this,Log);this._native=e}(0,_createClass2["default"])(Log,[{key:"setLoggable",value:function setLoggable(e,t){this._native.setLoggable(e,t)}},{key:"msg",value:function msg(e,t,n){if(this._native.isLoggable(t,e)){for(var r=0;r<n.length;++r){"function"==typeof n[r]&&(n[r]=n[r]());"object"===(0,_typeof2["default"])(n[r])&&("function"==typeof n[r].toString?n[r]=n[r].toString():n[r].constructor&&n[r].constructor.name?n[r]="{Object: ".concat(n[r].constructor.name,"}"):n[r]="{Object}")}this._native.msg(e,t,n)}}},{key:"level",get:function get(){return this._native._global_level},set:function set(e){this._native._global_level=e}}],[{key:"d",value:function d(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(arguments.length>=2){e=arguments[0];r=Array.prototype.slice.call(arguments,1)}else{e=undefined;r=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.DEBUG,e,r)}},{key:"e",value:function e(t,n){for(var r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];if(arguments.length>=2){t=arguments[0];a=Array.prototype.slice.call(arguments,1)}else{t=undefined;a=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.ERROR,t,a)}},{key:"i",value:function i(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(arguments.length>=2){e=arguments[0];r=Array.prototype.slice.call(arguments,1)}else{e=undefined;r=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.INFO,e,r)}},{key:"v",value:function v(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(arguments.length>=2){e=arguments[0];r=Array.prototype.slice.call(arguments,1)}else{e=undefined;r=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.VERBOSE,e,r)}},{key:"w",value:function w(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(arguments.length>=2){e=arguments[0];r=Array.prototype.slice.call(arguments,1)}else{e=undefined;r=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.WARNING,e,r)}},{key:"t",value:function t(e,n){for(var r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];if(arguments.length>=2){e=arguments[0];a=Array.prototype.slice.call(arguments,1)}else{e=undefined;a=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.TRACE,e,a)}}]);return Log}();g.Level={TRACE:1,VERBOSE:2,DEBUG:3,INFO:4,WARNING:5,ERROR:6,ASSERT:7,toStringTag:function toStringTag(e){switch(e){case g.TRACE:return"T";case g.VERBOSE:return"V";case g.DEBUG:return"D";case g.INFO:return"I";case g.WARNING:return"W";case g.ERROR:return"E";case g.ASSERT:return"A";default:return"*"}}};g.TRACE=g.Level.TRACE;g.VERBOSE=g.Level.VERBOSE;g.DEBUG=g.Level.DEBUG;g.INFO=g.Level.INFO;g.WARNING=g.Level.WARNING;g.ERROR=g.Level.ERROR;g.ASSERT=g.Level.ASSERT;g._instance=null;g.d.tag=function(e){return g.d.bind(null,e)};g.e.tag=function(e){return g.e.bind(null,e)};g.i.tag=function(e){return g.i.bind(null,e)};g.v.tag=function(e){return g.v.bind(null,e)};g.w.tag=function(e){return g.w.bind(null,e)};g.t.tag=function(e){return g.t.bind(null,e)};t.register(g);var k=function(){function LinkedList(){(0,_classCallCheck2["default"])(this,LinkedList);this._length=0;this._head=null;this._tail=null;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,a=_createForOfIteratorHelper(1===t.length&&Array.isArray(t[0])?t[0]:t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.push(i)}}catch(o){a.e(o)}finally{a.f()}}(0,_createClass2["default"])(LinkedList,[{key:"push",value:function push(e){var t={next:null,prev:this._head,value:e};this._push(t)}},{key:"_push",value:function _push(e){this._length++;if(this._head){this._head.next=e;this._head=e}else{this._head=e;this._tail=e}}},{key:"unshift",value:function unshift(e){var t={next:this._tail,prev:null,value:e};this._unshift(t)}},{key:"_unshift",value:function _unshift(e){this._length++;if(this._head){this._tail.prev=e;this._tail=e}else{this._head=e;this._tail=e}}},{key:"pop",value:function pop(){if(!this._head)return null;this._length--;var e=this._head,t=e.prev;if(!t){this._head=null;this._tail=null;return e.value}t.next=null;this._head=t;return e.value}},{key:"shift",value:function shift(){if(!this._head)return null;this._length--;var e=this._tail,t=e.next;if(!t){this._head=null;this._tail=null;return e.value}t.prev=null;this._tail=t;return e.value}},{key:"_remove",value:function _remove(e){if(e===this._head)this.pop();else if(e===this._tail)this.shift();else{this._length--;e.prev.next=e.next;e.next.prev=e.prev}}},{key:"clear",value:function clear(){this._length=0;this._head=null;this._tail=null}},{key:Symbol.iterator,value:function value(){return this.iterator()}},{key:"iterator",value:_regenerator["default"].mark(function iterator(){var e;return _regenerator["default"].wrap(function iterator$(t){for(;;)switch(t.prev=t.next){case 0:e=this._tail;case 1:if(!e){t.next=7;break}t.next=4;return e.value;case 4:e=e.next;t.next=1;break;case 7:case"end":return t.stop()}},iterator,this)})},{key:"isEmpty",value:function isEmpty(){return 0===this._length}},{key:"first",get:function get(){return this._tail?this._tail.value:null}},{key:"last",get:function get(){return this._head?this._head.value:null}},{key:"length",get:function get(){return this._length}}]);return LinkedList}();t.register(k);var m=function(e){(0,_inherits2["default"])(UniqueLinkedList,e);var t=_createSuper(UniqueLinkedList);function UniqueLinkedList(){var e;(0,_classCallCheck2["default"])(this,UniqueLinkedList);(e=t.call(this))._map=new Map;return e}(0,_createClass2["default"])(UniqueLinkedList,[{key:"push",value:function push(e){this._map.has(e)||(0,_get6["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"push",this).call(this,e)}},{key:"_push",value:function _push(e){(0,_get6["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"_push",this).call(this,e);this._map.set(e.value,e)}},{key:"unshift",value:function unshift(e){this._map.has(e)||(0,_get6["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"unshift",this).call(this,e)}},{key:"_unshift",value:function _unshift(e){(0,_get6["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"_unshift",this).call(this,e);this._map.set(e.value,e)}},{key:"pop",value:function pop(){var e=(0,_get6["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"pop",this).call(this);this._map["delete"](e);return e}},{key:"shift",value:function shift(){var e=(0,_get6["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"shift",this).call(this);this._map["delete"](e);return e}},{key:"clear",value:function clear(){(0,_get6["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"clear",this).call(this);this._map.clear()}},{key:"contains",value:function contains(e){return this._map.has(e)}},{key:"remove",value:function remove(e){var t=this._map.get(e);if(t){(0,_get6["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"_remove",this).call(this,t);this._map["delete"](e)}}},{key:"moveBack",value:function moveBack(e){var t=this._map.get(e);if(t){if(t===this._head)return;if(t===this._tail){t.next.prev=null;this._tail=t.next}else{t.prev.next=t.next;t.next.prev=t.prev}t.next=null;t.prev=this._head;this._head.next=t;this._head=t}else(0,_get6["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"push",this).call(this,e)}}]);return UniqueLinkedList}(k);t.register(m);var b=function(){function LRUMap(e){(0,_classCallCheck2["default"])(this,LRUMap);this._maxSize=e;this._map=new Map;this._accessQueue=new m}(0,_createClass2["default"])(LRUMap,[{key:"clear",value:function clear(){this._accessQueue.clear();return this._map.clear()}},{key:"delete",value:function _delete(e){this._accessQueue.remove(e);return this._map["delete"](e)}},{key:"entries",value:function entries(){return this._map.entries()}},{key:"forEach",value:function forEach(e,t){return this._map.forEach(e,t)}},{key:"get",value:function get(e){this._access(e);return this._map.get(e)}},{key:"has",value:function has(e){return this._map.has(e)}},{key:"keys",value:function keys(){return this._map.keys()}},{key:"evict",value:function evict(){for(var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;e>0&&this._accessQueue.length>0;){var t=this._accessQueue.shift();this._map["delete"](t);--e}}},{key:"_access",value:function _access(e){this._accessQueue.moveBack(e)}},{key:"set",value:function set(e,t){this.size>=this._maxSize&&this.evict();if(this.size<this._maxSize){this._map.set(e,t);this._access(e)}}},{key:"values",value:function values(){return this._map.values()}},{key:Symbol.iterator,value:function value(){return this._map.entries()}},{key:"size",get:function get(){return this._map.size}}]);return LRUMap}();t.register(b);var x=function(){function ObjectUtils(){(0,_classCallCheck2["default"])(this,ObjectUtils)}(0,_createClass2["default"])(ObjectUtils,null,[{key:"byKeyPath",value:function byKeyPath(e,t){if(!Array.isArray(t))return e[t];var n,r=e,a=_createForOfIteratorHelper(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(r===undefined)return undefined;r=r[i]}}catch(o){a.e(o)}finally{a.f()}return r}}]);return ObjectUtils}();t.register(x);Set.prototype.union=function(e){var t,n=new Set(this),r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.add(a)}}catch(i){r.e(i)}finally{r.f()}return n};Set.prototype.intersection=function(e){var t,n=new Set,r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;this.has(a)&&n.add(a)}}catch(i){r.e(i)}finally{r.f()}return n};Set.prototype.difference=function(e){var t,n=new Set(this),r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n["delete"](a)}}catch(i){r.e(i)}finally{r.f()}return n};Set.prototype.equals=function(e){if(this.size!==e.size)return!1;var t,n=_createForOfIteratorHelper(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!this.has(r))return!1}}catch(a){n.e(a)}finally{n.f()}return!0};Set.prototype.limit=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(null===e)return this;var t,n=new Set,r=0,a=_createForOfIteratorHelper(this);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(null!==e&&r>=e)break;n.add(i);r++}}catch(o){a.e(o)}finally{a.f()}return n};Set.from=function(e){return e&&"function"==typeof e[Symbol.iterator]&&"string"!=typeof e?new Set(e):new Set([e])};Set.sampleElement=function(e){return e.size>0?e.values().next().value:undefined};var w=function(){function SortedList(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[],t=arguments.length>1?arguments[1]:undefined;(0,_classCallCheck2["default"])(this,SortedList);this._list=e;this._compare=t||SortedList._compare}(0,_createClass2["default"])(SortedList,[{key:"indexOf",value:function indexOf(e){for(var t=0,n=this._list.length-1,r=null,a=null;t<=n;){r=Math.round((t+n)/2);a=this._list[r];if(this._compare(a,e)<0)t=r+1;else{if(!(this._compare(a,e)>0))return r;n=r-1}}return-1}},{key:"_insertionIndex",value:function _insertionIndex(e){for(var t=0,n=this._list.length-1,r=null,a=null;t<=n;){r=Math.round((t+n)/2);a=this._list[r];if(this._compare(a,e)<0)t=r+1;else{if(!(this._compare(a,e)>0))break;n=r-1}}return t}},{key:"add",value:function add(e){this._list.splice(this._insertionIndex(e),0,e)}},{key:"has",value:function has(e){return this.indexOf(e)>=0}},{key:"shift",value:function shift(){return this._list.shift()}},{key:"pop",value:function pop(){return this._list.pop()}},{key:"peekFirst",value:function peekFirst(){return this._list[0]}},{key:"peekLast",value:function peekLast(){return this._list[this._list.length-1]}},{key:"remove",value:function remove(e){var t=this.indexOf(e);t>-1&&this._list.splice(t,1)}},{key:"clear",value:function clear(){this._list=[]}},{key:"values",value:function values(){return this._list}},{key:Symbol.iterator,value:function value(){return this._list[Symbol.iterator]()}},{key:"copy",value:function copy(){return new SortedList(this._list.slice(),this._compare)}},{key:"length",get:function get(){return this._list.length}}],[{key:"_compare",value:function _compare(e,t){return e.compare?e.compare(t):e>t?1:e<t?-1:0}}]);return SortedList}();t.register(w);var S=function(){function Synchronizer(){(0,_classCallCheck2["default"])(this,Synchronizer);this._queue=[];this._working=!1}(0,_createClass2["default"])(Synchronizer,[{key:"push",value:function push(e){var t=this;return new Promise(function(n,r){t._queue.push({fn:e,resolve:n,error:r});t._working||t._doWork()["catch"](g.w.tag(Synchronizer))})}},{key:"_doWork",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee27(){var e,t;return _regenerator["default"].wrap(function _callee27$(n){for(;;)switch(n.prev=n.next){case 0:this._working=!0;case 1:if(!this._queue.length){n.next=15;break}e=this._queue.shift();n.prev=3;n.next=6;return e.fn();case 6:t=n.sent;e.resolve(t);n.next=13;break;case 10:n.prev=10;n.t0=n["catch"](3);e.error&&e.error(n.t0);case 13:n.next=1;break;case 15:this._working=!1;case 16:case"end":return n.stop()}},_callee27,this,[[3,10]])}));return function _doWork(){return e.apply(this,arguments)}}()},{key:"working",get:function get(){return this._working}}]);return Synchronizer}();t.register(S);var T=function(){function EncodedTransaction(e){(0,_classCallCheck2["default"])(this,EncodedTransaction);this._tableName=e;this._modified=new Map;this._removed=new Set;this._truncated=!1}(0,_createClass2["default"])(EncodedTransaction,[{key:"truncate",value:function truncate(){this._truncated=!0;this._modified.clear();this._removed.clear()}},{key:"put",value:function put(e,t){this._removed["delete"](e);this._modified.set(e,t)}},{key:"get",value:function get(e){return this._modified.get(e)}},{key:"remove",value:function remove(e){this._removed.add(e);this._modified["delete"](e)}},{key:"tableName",get:function get(){return this._tableName}},{key:"modified",get:function get(){return this._modified}},{key:"removed",get:function get(){return this._removed}},{key:"truncated",get:function get(){return this._truncated}}]);return EncodedTransaction}();t.register(T);var E=function(){function GenericValueEncoding(){(0,_classCallCheck2["default"])(this,GenericValueEncoding)}(0,_createClass2["default"])(GenericValueEncoding,null,[{key:"_encodeInteger",value:function _encodeInteger(e){var t=new Uint8Array(9),n=new DataView(t.buffer);n.setUint8(0,GenericValueEncoding.Type.INTEGER);n.setUint32(1,Math.floor(e/Math.pow(2,32)));n.setUint32(5,e);return t}},{key:"_decodeInteger",value:function _decodeInteger(e){var t=new DataView(e.buffer);return t.getUint32(1)*Math.pow(2,32)+t.getUint32(5)}},{key:"_encodeString",value:function _encodeString(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:GenericValueEncoding.Type.STRING,n=new Uint8Array(e.length+1);n[0]=t;for(var r=0;r<e.length;++r)n[r+1]=e.charCodeAt(r);return n}},{key:"_decodeString",value:function _decodeString(e){return String.fromCharCode.apply(null,e.subarray(1))}},{key:"_encodeOther",value:function _encodeOther(e){return GenericValueEncoding._encodeString(v.stringify(e),GenericValueEncoding.Type.JSON)}},{key:"_decodeOther",value:function _decodeOther(e){var t=GenericValueEncoding._decodeString(e);return v.parse(t)}},{key:"_encodeBuffer",value:function _encodeBuffer(e){var t=new Uint8Array(e.byteLength+1);t[0]=GenericValueEncoding.Type.BUFFER;t.set(e,1);return t}},{key:"_decodeBuffer",value:function _decodeBuffer(e){return e.subarray(1)}},{key:"encode",value:function encode(e){return Number.isInteger(e)?GenericValueEncoding._encodeInteger(e):"string"==typeof e?this._encodeString(e):e instanceof Uint8Array?GenericValueEncoding._encodeBuffer(e):GenericValueEncoding._encodeOther(e)}},{key:"decode",value:function decode(e){switch((e=new Uint8Array(e))[0]){case GenericValueEncoding.Type.INTEGER:return GenericValueEncoding._decodeInteger(e);case GenericValueEncoding.Type.STRING:return GenericValueEncoding._decodeString(e);case GenericValueEncoding.Type.BUFFER:return GenericValueEncoding._decodeBuffer(e);default:return GenericValueEncoding._decodeOther(e)}}},{key:"encoding",get:function get(){return i.Encoding.BINARY}}]);return GenericValueEncoding}();E.Type={INTEGER:0,STRING:1,JSON:2,BUFFER:3};t.register(E);var O=function(){function CachedBackend(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:CachedBackend.MAX_CACHE_SIZE,n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;(0,_classCallCheck2["default"])(this,CachedBackend);this._backend=e;this._cache=new b(t);this._rawCache=new b(n)}(0,_createClass2["default"])(CachedBackend,[{key:"_retrieveValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee28(e){var t,n,r,a;return _regenerator["default"].wrap(function _callee28$(i){for(;;)switch(i.prev=i.next){case 0:t=[];n=_createForOfIteratorHelper(e);try{for(n.s();!(r=n.n()).done;){a=r.value;t.push(this.get(a))}}catch(o){n.e(o)}finally{n.f()}return i.abrupt("return",Promise.all(t));case 4:case"end":return i.stop()}},_callee28,this)}));return function _retrieveValues(t){return e.apply(this,arguments)}}()},{key:"_has",value:function _has(e){return this._cache.has(e)||this._rawCache.has(e)}},{key:"_get",value:function _get(e,t){if(t&&t.raw){if(this._rawCache.has(e))return this._rawCache.get(e);var n=this.encode(this._cache.get(e));this._rawCache.set(e,n);return n}if(this._cache.has(e))return this._cache.get(e);var r=this.decode(this._rawCache.get(e),e);this._cache.set(e,r);return r}},{key:"getSync",value:function getSync(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(this._has(e))return this._get(e,t);if(this._backend.isSynchronous()){var n=this._backend.getSync(e,t);t&&t.raw?this._rawCache.set(e,n):this._cache.set(e,n);return n}if(t&&t.expectPresence)throw new Error("Missing key in cached backend: ".concat(e));return undefined}},{key:"isCached",value:function isCached(e){return!1}},{key:"get",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee29(e){var t,n,r=arguments;return _regenerator["default"].wrap(function _callee29$(a){for(;;)switch(a.prev=a.next){case 0:t=r.length>1&&r[1]!==undefined?r[1]:{};if(!this._has(e)){a.next=3;break}return a.abrupt("return",this._get(e,t));case 3:a.next=5;return this._backend.get(e,t);case 5:n=a.sent;t&&t.raw?this._rawCache.set(e,n):this._cache.set(e,n);return a.abrupt("return",n);case 8:case"end":return a.stop()}},_callee29,this)}));return function get(t){return e.apply(this,arguments)}}()},{key:"keys",value:function keys(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this._backend.keys(e,t)}},{key:"values",value:function values(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this._backend.values(e,t)}},{key:"keyStream",value:function keyStream(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return this._backend.keyStream(e,t,n)}},{key:"valueStream",value:function valueStream(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return this._backend.valueStream(e,t,n)}},{key:"maxValue",value:function maxValue(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return this._backend.maxValue(e)}},{key:"maxKey",value:function maxKey(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return this._backend.maxKey(e)}},{key:"minKey",value:function minKey(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return this._backend.minKey(e)}},{key:"minValue",value:function minValue(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return this._backend.minValue(e)}},{key:"count",value:function count(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return this._backend.count(e)}},{key:"_apply",value:function _apply(e){this._applyLocally(e);return this._backend._apply(e)}},{key:"_applyLocally",value:function _applyLocally(e){e._truncated&&this._cache.clear();var t,n=_createForOfIteratorHelper(e._removed);try{for(n.s();!(t=n.n()).done;){var r=t.value;this._cache["delete"](r)}}catch(c){n.e(c)}finally{n.f()}var a,i=_createForOfIteratorHelper(e._modified);try{for(i.s();!(a=i.n()).done;){var o=(0,_slicedToArray2["default"])(a.value,2),s=o[0],u=o[1];this._cache.set(s,u)}}catch(c){i.e(c)}finally{i.f()}}},{key:"truncate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee30(){return _regenerator["default"].wrap(function _callee30$(e){for(;;)switch(e.prev=e.next){case 0:this._cache.clear();return e.abrupt("return",this._backend.truncate());case 2:case"end":return e.stop()}},_callee30,this)}));return function truncate(){return e.apply(this,arguments)}}()},{key:"index",value:function index(e){return this._backend.index(e)}},{key:"createIndex",value:function createIndex(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return this._backend.createIndex(e,t,n)}},{key:"deleteIndex",value:function deleteIndex(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return this._backend.deleteIndex(e,t)}},{key:"close",value:function close(){return this._backend.close()}},{key:"applyCombined",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee31(e){var t=this;return _regenerator["default"].wrap(function _callee31$(n){for(;;)switch(n.prev=n.next){case 0:n.next=2;return this._backend.applyCombined(e);case 2:n.t0=n.sent;n.t1=function(){return t._applyLocally(e)};return n.abrupt("return",[n.t0,n.t1]);case 5:case"end":return n.stop()}},_callee31,this)}));return function applyCombined(t){return e.apply(this,arguments)}}()},{key:"isSynchronous",value:function isSynchronous(){return!0}},{key:"decode",value:function decode(e,t){return this._backend.decode(e,t)}},{key:"encode",value:function encode(e){return this._backend.encode(e)}},{key:"connected",get:function get(){return this._backend.connected}},{key:"indices",get:function get(){return this._backend.indices}}]);return CachedBackend}();O.MAX_CACHE_SIZE=5e3;t.register(O);var C=function(){function InMemoryIndex(e,t){var n=arguments.length>2&&arguments[2]!==undefined&&arguments[2],r=arguments.length>3&&arguments[3]!==undefined&&arguments[3];(0,_classCallCheck2["default"])(this,InMemoryIndex);this._objectStore=e;this._keyPath=t;this._multiEntry=n;this._unique=r;this._tree=new l}(0,_createClass2["default"])(InMemoryIndex,[{key:"truncate",value:function truncate(){this._tree=new l}},{key:"_indexKey",value:function _indexKey(e,t){return t===undefined?undefined:this.keyPath?x.byKeyPath(t,this.keyPath):e}},{key:"_insert",value:function _insert(e,t){var n=this._tree;this._multiEntry&&Array.isArray(t)||(t=[t]);var r,a=_createForOfIteratorHelper(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(n.seek(i)){if(this._unique)throw new Error("Uniqueness constraint violated for key ".concat(e," on path ").concat(this._keyPath));n.currentRecord.add(e)}else n.insert(i,this._unique?e:new w([e],y.compare))}}catch(o){a.e(o)}finally{a.f()}}},{key:"put",value:function put(e,t,n){var r=this._indexKey(e,n),a=this._indexKey(e,t);if(!y.equals(r,a)){r!==undefined&&this._remove(e,r);a!==undefined&&this._insert(e,a)}}},{key:"remove",value:function remove(e,t){var n=this._indexKey(e,t);n!==undefined&&this._remove(e,n)}},{key:"_remove",value:function _remove(e,t){var n=this._tree;this._multiEntry&&Array.isArray(t)||(t=[t]);var r,a=_createForOfIteratorHelper(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;n.seek(i)&&(!this._unique&&n.currentRecord.length>1?n.currentRecord.remove(e):n.remove(i))}}catch(o){a.e(o)}finally{a.f()}}},{key:"_retrieveValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee32(e){var t,n,r,a;return _regenerator["default"].wrap(function _callee32$(i){for(;;)switch(i.prev=i.next){case 0:t=[];n=_createForOfIteratorHelper(e);try{for(n.s();!(r=n.n()).done;){a=r.value;t.push(this._objectStore.get(a))}}catch(o){n.e(o)}finally{n.f()}return i.abrupt("return",Promise.all(t));case 4:case"end":return i.stop()}},_callee32,this)}));return function _retrieveValues(t){return e.apply(this,arguments)}}()},{key:"values",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee33(){var e,t,n,r=arguments;return _regenerator["default"].wrap(function _callee33$(a){for(;;)switch(a.prev=a.next){case 0:e=r.length>0&&r[0]!==undefined?r[0]:null;t=r.length>1&&r[1]!==undefined?r[1]:null;a.next=4;return this.keys(e,t);case 4:n=a.sent;return a.abrupt("return",this._retrieveValues(n));case 6:case"end":return a.stop()}},_callee33,this)}));return function values(){return e.apply(this,arguments)}}()},{key:"keys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee34(){var e,t,n,r=arguments;return _regenerator["default"].wrap(function _callee34$(a){for(;;)switch(a.prev=a.next){case 0:e=r.length>0&&r[0]!==undefined?r[0]:null;t=r.length>1&&r[1]!==undefined?r[1]:null;n=new Set;if(!(e instanceof A&&e.exactMatch)){a.next=6;break}this._tree.seek(e.lower)&&(n=Set.from(this._tree.currentRecord));return a.abrupt("return",n.limit(t));case 6:if(e instanceof A){a.next=11;break}if(this._tree.goTop()){a.next=9;break}return a.abrupt("return",n);case 9:a.next=13;break;case 11:if(this._tree.goToLowerBound(e.lower,e.lowerOpen)){a.next=13;break}return a.abrupt("return",n);case 13:if(e instanceof A&&!e.includes(this._tree.currentKey)){a.next=21;break}if(!(null!==t&&n.size>=t)){a.next=16;break}return a.abrupt("break",21);case 16:n=n.union(Set.from(this._tree.currentRecord));if(this._tree.skip()){a.next=19;break}return a.abrupt("break",21);case 19:a.next=13;break;case 21:return a.abrupt("return",n.limit(t));case 22:case"end":return a.stop()}},_callee34,this)}));return function keys(){return e.apply(this,arguments)}}()},{key:"keyStream",value:function keyStream(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(n instanceof A){if(t){if(!this._tree.goToLowerBound(n.lower,n.lowerOpen))return Promise.resolve()}else if(!this._tree.goToUpperBound(n.upper,n.upperOpen))return Promise.resolve()}else if(t){if(!this._tree.goTop())return Promise.resolve()}else if(!this._tree.goBottom())return Promise.resolve();e:for(;!(n instanceof A)||n.includes(this._tree.currentKey);){if(this._unique){if(!e(this._tree.currentRecord))break}else{var r=this._tree.currentRecord.values();if(t){for(var a=0;a<r.length;a++)if(!e(r[a]))break e}else for(var i=r.length-1;i>=0;i--)if(!e(r[i]))break e}if(!this._tree.skip(t?1:-1))break}return Promise.resolve()}},{key:"valueStream",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee35(e){var t,n,r,a,i,o=arguments;return _regenerator["default"].wrap(function _callee35$(s){for(;;)switch(s.prev=s.next){case 0:t=!(o.length>1&&o[1]!==undefined)||o[1];if((n=o.length>2&&o[2]!==undefined?o[2]:null)instanceof A){s.next=12;break}if(!t){s.next=8;break}if(this._tree.goTop()){s.next=6;break}return s.abrupt("return");case 6:s.next=10;break;case 8:if(this._tree.goBottom()){s.next=10;break}return s.abrupt("return");case 10:s.next=19;break;case 12:if(!t){s.next=17;break}if(this._tree.goToLowerBound(n.lower,n.lowerOpen)){s.next=15;break}return s.abrupt("return");case 15:s.next=19;break;case 17:if(this._tree.goToUpperBound(n.upper,n.upperOpen)){s.next=19;break}return s.abrupt("return");case 19:if(n instanceof A&&!n.includes(this._tree.currentKey)){s.next=62;break}if(!this._unique){s.next=30;break}s.t0=e;s.next=24;return this._objectStore.get(this._tree.currentRecord);case 24:s.t1=s.sent;s.t2=this._tree.currentRecord;if((0,s.t0)(s.t1,s.t2)){s.next=28;break}return s.abrupt("break",62);case 28:s.next=58;break;case 30:r=this._tree.currentRecord.values();if(!t){s.next=46;break}a=0;case 33:if(!(a<r.length)){s.next=44;break}s.t3=e;s.next=37;return this._objectStore.get(r[a]);case 37:s.t4=s.sent;s.t5=r[a];if((0,s.t3)(s.t4,s.t5)){s.next=41;break}return s.abrupt("break",62);case 41:a++;s.next=33;break;case 44:s.next=58;break;case 46:i=r.length-1;case 47:if(!(i>=0)){s.next=58;break}s.t6=e;s.next=51;return this._objectStore.get(r[i]);case 51:s.t7=s.sent;s.t8=r[i];if((0,s.t6)(s.t7,s.t8)){s.next=55;break}return s.abrupt("break",62);case 55:i--;s.next=47;break;case 58:if(this._tree.skip(t?1:-1)){s.next=60;break}return s.abrupt("break",62);case 60:s.next=19;break;case 62:case"end":return s.stop()}},_callee35,this)}));return function valueStream(t){return e.apply(this,arguments)}}()},{key:"maxValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee36(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee36$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.maxKeys(e);case 3:t=r.sent;return r.abrupt("return",this._retrieveValues(t));case 5:case"end":return r.stop()}},_callee36,this)}));return function maxValues(){return e.apply(this,arguments)}}()},{key:"maxKeys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee37(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee37$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;t=e instanceof A;if(this._tree.goToUpperBound(t?e.upper:undefined,!!t&&e.upperOpen)){r.next=4;break}return r.abrupt("return",new Set);case 4:return r.abrupt("return",Set.from(this._tree.currentRecord));case 5:case"end":return r.stop()}},_callee37,this)}));return function maxKeys(){return e.apply(this,arguments)}}()},{key:"minValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee38(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee38$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.minKeys(e);case 3:t=r.sent;return r.abrupt("return",this._retrieveValues(t));case 5:case"end":return r.stop()}},_callee38,this)}));return function minValues(){return e.apply(this,arguments)}}()},{key:"minKeys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee39(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee39$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;t=e instanceof A;if(this._tree.goToLowerBound(t?e.lower:undefined,!!t&&e.lowerOpen)){r.next=4;break}return r.abrupt("return",new Set);case 4:return r.abrupt("return",Set.from(this._tree.currentRecord));case 5:case"end":return r.stop()}},_callee39,this)}));return function minKeys(){return e.apply(this,arguments)}}()},{key:"count",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee40(){var e,t=arguments;return _regenerator["default"].wrap(function _callee40$(n){for(;;)switch(n.prev=n.next){case 0:e=t.length>0&&t[0]!==undefined?t[0]:null;n.next=3;return this.keys(e);case 3:return n.abrupt("return",n.sent.size);case 4:case"end":return n.stop()}},_callee40,this)}));return function count(){return e.apply(this,arguments)}}()},{key:"keyPath",get:function get(){return this._keyPath}},{key:"multiEntry",get:function get(){return this._multiEntry}},{key:"unique",get:function get(){return this._unique}}]);return InMemoryIndex}();t.register(C);var j=function(){function InMemoryBackend(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;(0,_classCallCheck2["default"])(this,InMemoryBackend);this._cache=new Map;this._indices=new Map;this._primaryIndex=new C(this,undefined,!1,!0);this._tableName=e;this._codec=t}(0,_createClass2["default"])(InMemoryBackend,[{key:"getSync",value:function getSync(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},n=this._cache.get(e);return t&&t.raw?n:this.decode(n,e)}},{key:"get",value:function get(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};try{return Promise.resolve(this.getSync(e,t))}catch(n){return Promise.reject(n)}}},{key:"values",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee41(){var e,t,n,r,a,i,o=arguments;return _regenerator["default"].wrap(function _callee41$(s){for(;;)switch(s.prev=s.next){case 0:e=o.length>0&&o[0]!==undefined?o[0]:null;t=o.length>1&&o[1]!==undefined?o[1]:null;if(!(null!==e&&e instanceof P)){s.next=4;break}return s.abrupt("return",e.values(this,t));case 4:n=[];s.t0=_createForOfIteratorHelper;s.next=8;return this.keys(e,t);case 8:s.t1=s.sent;r=(0,s.t0)(s.t1);s.prev=10;r.s();case 12:if((a=r.n()).done){s.next=21;break}i=a.value;s.t2=n;s.next=17;return this.get(i);case 17:s.t3=s.sent;s.t2.push.call(s.t2,s.t3);case 19:s.next=12;break;case 21:s.next=26;break;case 23:s.prev=23;s.t4=s["catch"](10);r.e(s.t4);case 26:s.prev=26;r.f();return s.finish(26);case 29:return s.abrupt("return",Promise.resolve(n));case 30:case"end":return s.stop()}},_callee41,this,[[10,23,26,29]])}));return function values(){return e.apply(this,arguments)}}()},{key:"keys",value:function keys(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return null!==e&&e instanceof P?e.keys(this,t):this._primaryIndex.keys(e,t)}},{key:"keyStream",value:function keyStream(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return this._primaryIndex.keyStream(e,t,n)}},{key:"valueStream",value:function valueStream(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return this._primaryIndex.valueStream(e,t,n)}},{key:"maxValue",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee42(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee42$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.maxKey(e);case 3:t=r.sent;return r.abrupt("return",this.get(t));case 5:case"end":return r.stop()}},_callee42,this)}));return function maxValue(){return e.apply(this,arguments)}}()},{key:"maxKey",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee43(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee43$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this._primaryIndex.maxKeys(e);case 3:t=r.sent;return r.abrupt("return",Set.sampleElement(t));case 5:case"end":return r.stop()}},_callee43,this)}));return function maxKey(){return e.apply(this,arguments)}}()},{key:"minValue",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee44(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee44$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.minKey(e);case 3:t=r.sent;return r.abrupt("return",this.get(t));case 5:case"end":return r.stop()}},_callee44,this)}));return function minValue(){return e.apply(this,arguments)}}()},{key:"minKey",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee45(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee45$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this._primaryIndex.minKeys(e);case 3:t=r.sent;return r.abrupt("return",Set.sampleElement(t));case 5:case"end":return r.stop()}},_callee45,this)}));return function minKey(){return e.apply(this,arguments)}}()},{key:"count",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee46(){var e,t=arguments;return _regenerator["default"].wrap(function _callee46$(n){for(;;)switch(n.prev=n.next){case 0:e=t.length>0&&t[0]!==undefined?t[0]:null;n.next=3;return this.keys(e);case 3:return n.abrupt("return",n.sent.size);case 4:case"end":return n.stop()}},_callee46,this)}));return function count(){return e.apply(this,arguments)}}()},{key:"index",value:function index(e){return this._indices.get(e)}},{key:"_apply",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee47(e){var t,n,r,a,i,o,s,u,c,l,f,h,d,_;return _regenerator["default"].wrap(function _callee47$(p){for(;;)switch(p.prev=p.next){case 0:e._truncated&&this.truncateSync();t=new Map;n=_createForOfIteratorHelper(e._removed);try{for(n.s();!(r=n.n()).done;){a=r.value;(i=this.getSync(a))&&t.set(a,i);this._cache["delete"](a)}}catch(y){n.e(y)}finally{n.f()}o=_createForOfIteratorHelper(e._modified);try{for(o.s();!(s=o.n()).done;){u=(0,_slicedToArray2["default"])(s.value,2),c=u[0],l=u[1];(f=this.getSync(c))&&t.set(c,f);this._cache.set(c,this.encode(l))}}catch(y){o.e(y)}finally{o.f()}InMemoryBackend._indexApply(this._primaryIndex,e,t);h=_createForOfIteratorHelper(this._indices.values());try{for(h.s();!(d=h.n()).done;){_=d.value;InMemoryBackend._indexApply(_,e,t)}}catch(y){h.e(y)}finally{h.f()}case 9:case"end":return p.stop()}},_callee47,this)}));return function _apply(t){return e.apply(this,arguments)}}()},{key:"truncate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee48(){return _regenerator["default"].wrap(function _callee48$(e){for(;;)switch(e.prev=e.next){case 0:this.truncateSync();case 1:case"end":return e.stop()}},_callee48,this)}));return function truncate(){return e.apply(this,arguments)}}()},{key:"truncateSync",value:function truncateSync(){this._cache.clear();this._primaryIndex.truncate();var e,t=_createForOfIteratorHelper(this._indices.values());try{for(t.s();!(e=t.n()).done;){e.value.truncate()}}catch(n){t.e(n)}finally{t.f()}}},{key:"map",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee49(e){var t,n,r,a,i;return _regenerator["default"].wrap(function _callee49$(o){for(;;)switch(o.prev=o.next){case 0:t=_createForOfIteratorHelper(this._cache);try{for(t.s();!(n=t.n()).done;){r=(0,_slicedToArray2["default"])(n.value,2),a=r[0],i=r[1];e(a,i)}}catch(s){t.e(s)}finally{t.f()}case 2:case"end":return o.stop()}},_callee49,this)}));return function map(t){return e.apply(this,arguments)}}()},{key:"createIndex",value:function createIndex(e,t){var n=(arguments.length>2&&arguments[2]!==undefined?arguments[2]:{})||{},r=n.multiEntry,a=void 0!==r&&r,i=n.unique,o=void 0!==i&&i,s=(n.upgradeCondition,new C(this,t=t||e,a,o));this._indices.set(e,s)}},{key:"deleteIndex",value:function deleteIndex(e){((arguments.length>1&&arguments[1]!==undefined?arguments[1]:{})||{}).upgradeCondition;this._indices["delete"](e)}},{key:"decode",value:function decode(e,t){return e===undefined?undefined:null!==this._codec&&this._codec!==undefined?this._codec.decode(e,t):e}},{key:"encode",value:function encode(e){return e===undefined?undefined:null!==this._codec&&this._codec!==undefined?this._codec.encode(e):e}},{key:"applyCombined",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee50(e){var t=this;return _regenerator["default"].wrap(function _callee50$(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",function(){return t._apply(e)});case 1:case"end":return n.stop()}},_callee50)}));return function applyCombined(t){return e.apply(this,arguments)}}()},{key:"isSynchronous",value:function isSynchronous(){return!0}},{key:"isCached",value:function isCached(e){return!0}},{key:"connected",get:function get(){return!0}},{key:"indices",get:function get(){return this._indices}},{key:"tableName",get:function get(){return this._tableName}}],[{key:"_indexApply",value:function _indexApply(e,t,n){t._truncated&&e.truncate();var r,a=_createForOfIteratorHelper(t._removed);try{for(a.s();!(r=a.n()).done;){var i=r.value;e.remove(i,n.get(i))}}catch(f){a.e(f)}finally{a.f()}var o,s=_createForOfIteratorHelper(t._modified);try{for(s.s();!(o=s.n()).done;){var u=(0,_slicedToArray2["default"])(o.value,2),c=u[0],l=u[1];e.put(c,l,n.get(c))}}catch(f){s.e(f)}finally{s.f()}}}]);return InMemoryBackend}();t.register(j);var A=function(){function KeyRange(e,t,n,r){(0,_classCallCheck2["default"])(this,KeyRange);this._lower=e;this._upper=t;this._lowerOpen=n;this._upperOpen=r}(0,_createClass2["default"])(KeyRange,[{key:"includes",value:function includes(e){return(this._lower===undefined||y.compare(this._lower,e)<0||!this._lowerOpen&&y.equals(this._lower,e))&&(this._upper===undefined||y.compare(this._upper,e)>0||!this._upperOpen&&y.equals(this._upper,e))}},{key:"lower",get:function get(){return this._lower}},{key:"upper",get:function get(){return this._upper}},{key:"lowerOpen",get:function get(){return this._lowerOpen}},{key:"upperOpen",get:function get(){return this._upperOpen}},{key:"exactMatch",get:function get(){return this._lower===this._upper&&!this._lowerOpen&&!this.upperOpen}}],[{key:"upperBound",value:function upperBound(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1];return new KeyRange(undefined,e,!1,t)}},{key:"lowerBound",value:function lowerBound(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1];return new KeyRange(e,undefined,t,!1)}},{key:"bound",value:function bound(e,t){return new KeyRange(e,t,arguments.length>2&&arguments[2]!==undefined&&arguments[2],arguments.length>3&&arguments[3]!==undefined&&arguments[3])}},{key:"only",value:function only(e){return new KeyRange(e,e,!1,!1)}}]);return KeyRange}();t.register(A);var B=function(){function ObjectStore(e,t,n){(0,_classCallCheck2["default"])(this,ObjectStore);this._backend=e;this._db=t;this._name=n;this._stateStack=[];this._backendInfo=new I(this._backend,null);this._transactions=new Map;this._transactions.set(ObjectStore.BACKEND_ID,this._backendInfo);this._snapshotManager=new G;this._synchronizer=new S}(0,_createClass2["default"])(ObjectStore,[{key:"get",value:function get(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.get(e,t)}},{key:"put",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee51(e,t){var n;return _regenerator["default"].wrap(function _callee51$(r){for(;;)switch(r.prev=r.next){case 0:if(this._backend.connected){r.next=2;break}throw new Error("JungleDB is not connected");case 2:n=this.transaction();r.prev=3;r.next=6;return n.put(e,t);case 6:r.next=13;break;case 8:r.prev=8;r.t0=r["catch"](3);r.next=12;return n.abort();case 12:throw r.t0;case 13:return r.abrupt("return",n.commit());case 14:case"end":return r.stop()}},_callee51,this,[[3,8]])}));return function put(t,n){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee52(e){var t;return _regenerator["default"].wrap(function _callee52$(n){for(;;)switch(n.prev=n.next){case 0:if(this._backend.connected){n.next=2;break}throw new Error("JungleDB is not connected");case 2:t=this.transaction();n.prev=3;n.next=6;return t.remove(e);case 6:n.next=13;break;case 8:n.prev=8;n.t0=n["catch"](3);n.next=12;return t.abort();case 12:throw n.t0;case 13:return n.abrupt("return",t.commit());case 14:case"end":return n.stop()}},_callee52,this,[[3,8]])}));return function remove(t){return e.apply(this,arguments)}}()},{key:"getSync",value:function getSync(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!this._backend.connected)throw new Error("JungleDB is not connected");if(!this._currentState.isSynchronous())throw new Error("Only works on synchronous backends");return this._currentState.getSync(e,t)}},{key:"isCached",value:function isCached(e){if(!this._backend.connected)throw new Error("JungleDB is not connected");if(!this._currentState.isSynchronous())throw new Error("Only works on synchronous backends");return this._currentState.isCached(e)}},{key:"keys",value:function keys(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!this._backend.connected)throw new Error("JungleDB is not connected");return null!==e&&e instanceof P?e.keys(this._currentState,t):this._currentState.keys(e,t)}},{key:"values",value:function values(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!this._backend.connected)throw new Error("JungleDB is not connected");return null!==e&&e instanceof P?e.values(this._currentState,t):this._currentState.values(e,t)}},{key:"keyStream",value:function keyStream(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return this._currentState.keyStream(e,t,n)}},{key:"valueStream",value:function valueStream(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return this._currentState.valueStream(e,t,n)}},{key:"maxValue",value:function maxValue(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.maxValue(e)}},{key:"maxKey",value:function maxKey(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.maxKey(e)}},{key:"minKey",value:function minKey(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.minKey(e)}},{key:"minValue",value:function minValue(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.minValue(e)}},{key:"count",value:function count(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.count(e)}},{key:"commit",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee53(e){return _regenerator["default"].wrap(function _callee53$(t){for(;;)switch(t.prev=t.next){case 0:if(this._isCommittable(e)){t.next=4;break}t.next=3;return this.abort(e);case 3:return t.abrupt("return",!1);case 4:t.next=6;return this._commitInternal(e);case 6:return t.abrupt("return",!0);case 7:case"end":return t.stop()}},_callee53,this)}));return function commit(t){return e.apply(this,arguments)}}()},{key:"_isCommittable",value:function _isCommittable(e){if(!this._backend.connected)throw new Error("JungleDB is not connected");if(!(e instanceof R&&e.state===R.STATE.OPEN&&this._transactions.has(e.id)))throw new Error("Can only commit open transactions");return this._transactions.get(e.id).isCommittable()}},{key:"_commitBackend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee54(){return _regenerator["default"].wrap(function _callee54$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Cannot commit object stores");case 1:case"end":return e.stop()}},_callee54)}));return function _commitBackend(){return e.apply(this,arguments)}}()},{key:"_commitInternal",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee55(e){var t;return _regenerator["default"].wrap(function _callee55$(n){for(;;)switch(n.prev=n.next){case 0:t=this._transactions.get(e.id);if(!(this._stateStack.length>=ObjectStore.MAX_STACK_SIZE)){n.next=4;break}g.e(ObjectStore,"Transaction stack size exceeded ".concat(this.toStringFull()));throw new Error("Transaction stack size exceeded");case 4:this._stateStack.push(t);t.close();if(!t.isFlushable()){n.next=9;break}n.next=9;return this._flattenState(e);case 9:case"end":return n.stop()}},_callee55,this)}));return function _commitInternal(t){return e.apply(this,arguments)}}()},{key:"_setParent",value:function _setParent(e){throw new Error("Unsupported operation")}},{key:"abort",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee56(e){var t;return _regenerator["default"].wrap(function _callee56$(n){for(;;)switch(n.prev=n.next){case 0:if(this._backend.connected){n.next=2;break}throw new Error("JungleDB is not connected");case 2:if(!(e instanceof D)){n.next=4;break}return n.abrupt("return",this._snapshotManager.abortSnapshot(e));case 4:if(e instanceof R&&e.state===R.STATE.OPEN&&this._transactions.has(e.id)){n.next=6;break}throw new Error("Can only abort open transactions");case 6:(t=this._transactions.get(e.id)).abort();if(!t.parent||0!==t.parent.numOpenChildren){n.next=11;break}n.next=11;return this._flattenState();case 11:this._transactions["delete"](e.id);return n.abrupt("return",!0);case 13:case"end":return n.stop()}},_callee56,this)}));return function abort(t){return e.apply(this,arguments)}}()},{key:"_flattenState",value:function _flattenState(e){var t=this;return this._synchronizer.push(function(){return t._flattenStateInternal(e)})}},{key:"_flattenStateInternal",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee57(e){var t,n,r,a,i=this;return _regenerator["default"].wrap(function _callee57$(o){for(;;)switch(o.prev=o.next){case 0:if(!(e&&e instanceof R)){o.next=32;break}if((t=this._transactions.get(e.id)).isFlushable()){o.next=4;break}return o.abrupt("return",!1);case 4:n=t.parent.transaction;r=function cleanup(){t.flush();i._transactions["delete"](e.id);var n=i._stateStack.indexOf(t);n>=0&&i._stateStack.splice(n,1);i._flattenState()["catch"](g.w.tag(ObjectStore))};if(null!==e.dependency){o.next=27;break}if(!t.parent.isBackend()){o.next=10;break}o.next=10;return this._snapshotManager.applyTx(e,n);case 10:o.prev=10;o.next=13;return n._apply(e);case 13:o.next=23;break;case 15:o.prev=15;o.t0=o["catch"](10);t.abort();this._transactions["delete"](e.id);(a=this._stateStack.indexOf(t))>=0&&this._stateStack.splice(a,1);e._setAborted();g.e(ObjectStore,"Error while applying transaction",o.t0);case 23:r();return o.abrupt("return",!0);case 27:o.next=29;return e.dependency.onFlushable(e,r,function(){return i._snapshotManager.applyTx(e,n)});case 29:return o.abrupt("return",o.sent);case 30:o.next=47;break;case 32:if(!(this._stateStack.length>0)){o.next=39;break}o.next=35;return this._flattenStateInternal(this._currentState);case 35:if(o.sent){o.next=37;break}return o.abrupt("break",39);case 37:o.next=32;break;case 39:if(!(this._stateStack.length>0)){o.next=46;break}o.next=42;return this._flattenStateInternal(this._stateStack[0].transaction);case 42:if(o.sent){o.next=44;break}return o.abrupt("break",46);case 44:o.next=39;break;case 46:return o.abrupt("return",!1);case 47:case"end":return o.stop()}},_callee57,this,[[10,15]])}));return function _flattenStateInternal(t){return e.apply(this,arguments)}}()},{key:"index",value:function index(e){if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.index(e)}},{key:"createIndex",value:function createIndex(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return this._backend.createIndex(e,t,n)}},{key:"deleteIndex",value:function deleteIndex(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return this._backend.deleteIndex(e,t)}},{key:"transaction",value:function transaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];if(!this._backend.connected)throw new Error("JungleDB is not connected");if(this._backend.isSynchronous())return this.synchronousTransaction(e);var t=new R(this,this._currentState,this,e);this._transactions.set(t.id,new I(t,this._currentStateInfo));return t}},{key:"synchronousTransaction",value:function synchronousTransaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];if(!this._backend.connected)throw new Error("JungleDB is not connected");var t=new N(this,this._currentState,this,e);this._transactions.set(t.id,new I(t,this._currentStateInfo));return t}},{key:"isSynchronous",value:function isSynchronous(){return this._backend.isSynchronous()}},{key:"snapshot",value:function snapshot(){return this._currentStateId!==ObjectStore.BACKEND_ID?this._currentState.snapshot():this._snapshotManager.createSnapshot(this,this._currentState)}},{key:"_apply",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee58(e){return _regenerator["default"].wrap(function _callee58$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Unsupported operation");case 1:case"end":return e.stop()}},_callee58)}));return function _apply(t){return e.apply(this,arguments)}}()},{key:"truncate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee59(){var e;return _regenerator["default"].wrap(function _callee59$(t){for(;;)switch(t.prev=t.next){case 0:if(this._backend.connected){t.next=2;break}throw new Error("JungleDB is not connected");case 2:e=this.transaction();t.next=5;return e.truncate();case 5:return t.abrupt("return",e.commit());case 6:case"end":return t.stop()}},_callee59,this)}));return function truncate(){return e.apply(this,arguments)}}()},{key:"close",value:function close(){if(this._stateStack.length>0)throw new Error("Cannot close database while transactions are active");return this._backend.close()}},{key:"decode",value:function decode(e,t){return this._backend.decode(e,t)}},{key:"encode",value:function encode(e){return this._backend.encode(e)}},{key:"toStringFull",value:function toStringFull(){return"ObjectStore{\n    stack=[".concat(this._stateStack.map(function(e){return"{tx=".concat(e,", open=").concat(e.numOpenChildren,"}")}),"],\n    db=").concat(this._db,"/").concat(this._name?this._name:"unnamed","\n}")}},{key:"toString",value:function toString(){return"ObjectStore{stackSize=".concat(this._stateStack.length,", db=").concat(this._db,"/").concat(this._name?this._name:"unnamed","}")}},{key:"jungleDB",get:function get(){return this._db}},{key:"connected",get:function get(){return this._backend.connected}},{key:"_currentState",get:function get(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].transaction:this._backend}},{key:"_currentStateInfo",get:function get(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1]:this._backendInfo}},{key:"_currentStateId",get:function get(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].id:ObjectStore.BACKEND_ID}},{key:"indices",get:function get(){if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.indices}}]);return ObjectStore}();B.MAX_STACK_SIZE=10;B.BACKEND_ID="backend";t.register(B);var I=function(){function TransactionInfo(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];(0,_classCallCheck2["default"])(this,TransactionInfo);this.transaction=e;this.children=n;this._parentInfo=t;this._open=!0;this._parentInfo&&this._parentInfo.addChild(this)}(0,_createClass2["default"])(TransactionInfo,[{key:"addChild",value:function addChild(e){this.children.push(e)}},{key:"removeChild",value:function removeChild(e){var t=this.children.indexOf(e);t>=0&&this.children.splice(t,1)}},{key:"flush",value:function flush(){if(!this.isBackend()){var e=this.parent;this.parent.removeChild(this);var t,n=_createForOfIteratorHelper(this.children.slice());try{for(n.s();!(t=n.n()).done;){t.value.parent=e}}catch(r){n.e(r)}finally{n.f()}this.children=[];this._parentInfo=null}}},{key:"abort",value:function abort(){this.isBackend()||this.parent.removeChild(this)}},{key:"close",value:function close(){this._open=!1}},{key:"isBackend",value:function isBackend(){return null===this._parentInfo}},{key:"isOpen",value:function isOpen(){return this._open}},{key:"isCommittable",value:function isCommittable(){return this._parentInfo&&this._parentInfo.children.every(function(e){return e.isOpen()})}},{key:"isFlushable",value:function isFlushable(){return this.parent&&0===this.parent.numOpenChildren&&(null===this.transaction.dependency||this.parent.isBackend())}},{key:"toString",value:function toString(){return this.transaction.toStringShort()}},{key:"parent",get:function get(){return this._parentInfo},set:function set(e){this.parent.removeChild(this);this._parentInfo=e;this.parent.addChild(this);this.transaction._setParent(e.transaction)}},{key:"id",get:function get(){return this.isBackend()?B.BACKEND_ID:this.transaction.id}},{key:"numOpenChildren",get:function get(){return this.children.filter(function(e){return e.isOpen()}).length}}]);return TransactionInfo}(),P=function(){(0,_createClass2["default"])(Query,null,[{key:"_parseKeyRange",value:function _parseKeyRange(e,t,n){switch(e){case Query.OPERATORS.GT:return A.lowerBound(t,!0);case Query.OPERATORS.GE:return A.lowerBound(t,!1);case Query.OPERATORS.LT:return A.upperBound(t,!0);case Query.OPERATORS.LE:return A.upperBound(t,!1);case Query.OPERATORS.EQ:return A.only(t);case Query.OPERATORS.BETWEEN:return A.bound(t,n,!0,!0);case Query.OPERATORS.WITHIN:return A.bound(t,n,!1,!1)}g.e("Unknown operator: ".concat(e));throw new Error("Unknown operator")}},{key:"and",value:function and(e){return new Query(Array.from(arguments),Query.OPERATORS.AND)}},{key:"or",value:function or(e){return new Query(Array.from(arguments),Query.OPERATORS.OR)}},{key:"max",value:function max(e){return new Query(e,Query.OPERATORS.MAX)}},{key:"min",value:function min(e){return new Query(e,Query.OPERATORS.MIN)}},{key:"lt",value:function lt(e,t){return new Query(e,Query.OPERATORS.LT,t)}},{key:"le",value:function le(e,t){return new Query(e,Query.OPERATORS.LE,t)}},{key:"gt",value:function gt(e,t){return new Query(e,Query.OPERATORS.GT,t)}},{key:"ge",value:function ge(e,t){return new Query(e,Query.OPERATORS.GE,t)}},{key:"eq",value:function eq(e,t){return new Query(e,Query.OPERATORS.EQ,t)}},{key:"between",value:function between(e,t,n){return new Query(e,Query.OPERATORS.BETWEEN,t,n)}},{key:"within",value:function within(e,t,n){return new Query(e,Query.OPERATORS.WITHIN,t,n)}}]);function Query(e,t,n,r){(0,_classCallCheck2["default"])(this,Query);if(Array.isArray(e)){if(e.some(function(e){return!(e instanceof Query)}))throw new Error("Invalid query");if(Query.COMBINED_OPERATORS.indexOf(t)<0)throw new Error("Unknown operator");this._queryType=Query.Type.COMBINED;this._queries=e;this._op=t}else{if(Query.RANGE_OPERATORS.indexOf(t)>=0){this._queryType=Query.Type.RANGE;this._keyRange=Query._parseKeyRange(t,n,r)}else{if(!(Query.ADVANCED_OPERATORS.indexOf(t)>=0))throw new Error("Unknown operator");this._queryType=Query.Type.ADVANCED;this._op=t}this._indexName=e}}(0,_createClass2["default"])(Query,[{key:"values",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee60(e){var t,n,r,a,i,o,s=arguments;return _regenerator["default"].wrap(function _callee60$(u){for(;;)switch(u.prev=u.next){case 0:t=s.length>1&&s[1]!==undefined?s[1]:null;u.next=3;return this._execute(e,t);case 3:n=u.sent;r=[];a=_createForOfIteratorHelper(n);try{for(a.s();!(i=a.n()).done;){o=i.value;r.push(e.get(o))}}catch(c){a.e(c)}finally{a.f()}return u.abrupt("return",Promise.all(r));case 8:case"end":return u.stop()}},_callee60,this)}));return function values(t){return e.apply(this,arguments)}}()},{key:"keys",value:function keys(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this._execute(e,t)}},{key:"_execute",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee61(e){var t,n=arguments;return _regenerator["default"].wrap(function _callee61$(r){for(;;)switch(r.prev=r.next){case 0:t=n.length>1&&n[1]!==undefined?n[1]:null;r.t0=this._queryType;r.next=r.t0===Query.Type.COMBINED?4:r.t0===Query.Type.ADVANCED?5:r.t0===Query.Type.RANGE?6:7;break;case 4:return r.abrupt("return",Promise.resolve(this._executeCombined(e,t)));case 5:return r.abrupt("return",Promise.resolve(this._executeAdvanced(e,t)));case 6:return r.abrupt("return",this._executeRange(e,t));case 7:return r.abrupt("return",Promise.resolve(new Set));case 8:case"end":return r.stop()}},_callee61,this)}));return function _execute(t){return e.apply(this,arguments)}}()},{key:"_executeCombined",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee62(e){var t,n,r,a,i,o,s,u,c,l,f,h,d,_,p,y,v,g,k,m,b=arguments;return _regenerator["default"].wrap(function _callee62$(x){for(;;)switch(x.prev=x.next){case 0:t=b.length>1&&b[1]!==undefined?b[1]:null;n=[];r=_createForOfIteratorHelper(this._queries);try{for(r.s();!(a=r.n()).done;){i=a.value;n.push(i._execute(e,t))}}catch(w){r.e(w)}finally{r.f()}x.next=6;return Promise.all(n);case 6:o=x.sent;if(this._op!==Query.OPERATORS.AND){x.next=40;break}if(0!==o.length){x.next=12;break}return x.abrupt("return",new Set);case 12:if(1!==o.length){x.next=16;break}if(!(null===t||t>=1)){x.next=15;break}return x.abrupt("return",o[0]);case 15:return x.abrupt("return",new Set);case 16:s=o.shift();u=new Set;c=0;l=_createForOfIteratorHelper(s);x.prev=20;h=function _loop(){var e=f.value;if(o.every(function(t){return t.has(e)})){if(null!==t&&c>=t)return"break";u.add(e);c++}};l.s();case 23:if((f=l.n()).done){x.next=29;break}if("break"!==h()){x.next=27;break}return x.abrupt("break",29);case 27:x.next=23;break;case 29:x.next=34;break;case 31:x.prev=31;x.t0=x["catch"](20);l.e(x.t0);case 34:x.prev=34;l.f();return x.finish(34);case 37:return x.abrupt("return",u);case 40:if(this._op!==Query.OPERATORS.OR){x.next=80;break}d=new Set;_=0;p=_createForOfIteratorHelper(o);x.prev=44;p.s();case 46:if((y=p.n()).done){x.next=71;break}v=y.value;g=_createForOfIteratorHelper(v);x.prev=49;g.s();case 51:if((k=g.n()).done){x.next=59;break}m=k.value;if(!(null!==t&&_>=t)){x.next=55;break}return x.abrupt("break",59);case 55:d.add(m);_++;case 57:x.next=51;break;case 59:x.next=64;break;case 61:x.prev=61;x.t1=x["catch"](49);g.e(x.t1);case 64:x.prev=64;g.f();return x.finish(64);case 67:if(!(null!==t&&_>=t)){x.next=69;break}return x.abrupt("break",71);case 69:x.next=46;break;case 71:x.next=76;break;case 73:x.prev=73;x.t2=x["catch"](44);p.e(x.t2);case 76:x.prev=76;p.f();return x.finish(76);case 79:return x.abrupt("return",d);case 80:return x.abrupt("return",new Set);case 81:case"end":return x.stop()}},_callee62,this,[[20,31,34,37],[44,73,76,79],[49,61,64,67]])}));return function _executeCombined(t){return e.apply(this,arguments)}}()},{key:"_executeAdvanced",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee63(e){var t,n,r,a=arguments;return _regenerator["default"].wrap(function _callee63$(i){for(;;)switch(i.prev=i.next){case 0:t=a.length>1&&a[1]!==undefined?a[1]:null;n=e.index(this._indexName);r=new Set;i.t0=this._op;i.next=i.t0===Query.OPERATORS.MAX?6:i.t0===Query.OPERATORS.MIN?10:14;break;case 6:i.next=8;return n.maxKeys();case 8:r=i.sent;return i.abrupt("break",14);case 10:i.next=12;return n.minKeys();case 12:r=i.sent;return i.abrupt("break",14);case 14:return i.abrupt("return",new Set(r.limit(t)));case 15:case"end":return i.stop()}},_callee63,this)}));return function _executeAdvanced(t){return e.apply(this,arguments)}}()},{key:"_executeRange",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee64(e){var t,n,r=arguments;return _regenerator["default"].wrap(function _callee64$(a){for(;;)switch(a.prev=a.next){case 0:t=r.length>1&&r[1]!==undefined?r[1]:null;n=e.index(this._indexName);a.t0=Set;a.next=5;return n.keys(this._keyRange,t);case 5:a.t1=a.sent;return a.abrupt("return",new a.t0(a.t1));case 7:case"end":return a.stop()}},_callee64,this)}));return function _executeRange(t){return e.apply(this,arguments)}}()}]);return Query}();P.OPERATORS={GT:0,GE:1,LT:2,LE:3,EQ:4,BETWEEN:7,WITHIN:8,MAX:9,MIN:10,AND:11,OR:12};P.RANGE_OPERATORS=[P.OPERATORS.GT,P.OPERATORS.GE,P.OPERATORS.LT,P.OPERATORS.LE,P.OPERATORS.EQ,P.OPERATORS.BETWEEN,P.OPERATORS.WITHIN];P.ADVANCED_OPERATORS=[P.OPERATORS.MAX,P.OPERATORS.MIN];P.COMBINED_OPERATORS=[P.OPERATORS.AND,P.OPERATORS.OR];P.Type={RANGE:0,ADVANCED:1,COMBINED:2};t.register(P);var L=function(e){(0,_inherits2["default"])(TransactionIndex,e);var t=_createSuper(TransactionIndex);(0,_createClass2["default"])(TransactionIndex,[{key:"_index",get:function get(){return this._backend.index(this._databaseDir)}}],[{key:"derive",value:function derive(e,t){var n,r=new Map,a=_createForOfIteratorHelper(t.indices);try{for(a.s();!(n=a.n()).done;){var i=(0,_slicedToArray2["default"])(n.value,2),o=i[0],s=i[1];r.set(o,new TransactionIndex(e,t,o,s.keyPath,s.multiEntry,s.unique))}}catch(u){a.e(u)}finally{a.f()}return r}}]);function TransactionIndex(e,n,r,a){var i,o=arguments.length>4&&arguments[4]!==undefined&&arguments[4],s=arguments.length>5&&arguments[5]!==undefined&&arguments[5];(0,_classCallCheck2["default"])(this,TransactionIndex);(i=t.call(this,e,a,o,s))._backend=n;i._databaseDir=r;return i}(0,_createClass2["default"])(TransactionIndex,[{key:"checkUniqueConstraint",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee65(e,t){var n,r,a,i,o,s=arguments;return _regenerator["default"].wrap(function _callee65$(u){for(;;)switch(u.prev=u.next){case 0:n=!(s.length>2&&s[2]!==undefined)||s[2];if(this.unique){u.next=3;break}return u.abrupt("return");case 3:if((r=this._indexKey(e,t))===undefined){u.next=26;break}this.multiEntry&&Array.isArray(r)||(r=[r]);a=_createForOfIteratorHelper(r);u.prev=7;a.s();case 9:if((i=a.n()).done){u.next=18;break}o=i.value;u.next=13;return this.count(A.only(o));case 13:if(!(u.sent>(n?1:0))){u.next=16;break}throw new Error("Uniqueness constraint violated for key ".concat(o," on path ").concat(this._keyPath));case 16:u.next=9;break;case 18:u.next=23;break;case 20:u.prev=20;u.t0=u["catch"](7);a.e(u.t0);case 23:u.prev=23;a.f();return u.finish(23);case 26:case"end":return u.stop()}},_callee65,this,[[7,20,23,26]])}));return function checkUniqueConstraint(t,n){return e.apply(this,arguments)}}()},{key:"keys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee66(){var e,t,n,r,a,i,o,s=arguments;return _regenerator["default"].wrap(function _callee66$(u){for(;;)switch(u.prev=u.next){case 0:e=s.length>0&&s[0]!==undefined?s[0]:null;t=s.length>1&&s[1]!==undefined?s[1]:null;n=[];this._objectStore._truncated?n.push(new Set):n.push(this._index.keys(e,t));n.push(C.prototype.keys.call(this,e,t));u.next=7;return Promise.all(n);case 7:r=u.sent;a=(0,_slicedToArray2["default"])(r,2);i=a[0];o=a[1];i=(i=i.difference(this._objectStore._removed)).difference(this._objectStore._modified.keys());return u.abrupt("return",i.union(o).limit(t));case 14:case"end":return u.stop()}},_callee66,this)}));return function keys(){return e.apply(this,arguments)}}()},{key:"values",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee67(){var e,t,n,r=arguments;return _regenerator["default"].wrap(function _callee67$(a){for(;;)switch(a.prev=a.next){case 0:e=r.length>0&&r[0]!==undefined?r[0]:null;t=r.length>1&&r[1]!==undefined?r[1]:null;a.next=4;return this.keys(e,t);case 4:n=a.sent;return a.abrupt("return",C.prototype._retrieveValues.call(this,n));case 6:case"end":return a.stop()}},_callee67,this)}));return function values(){return e.apply(this,arguments)}}()},{key:"maxValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee68(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee68$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.maxKeys(e);case 3:t=r.sent;return r.abrupt("return",C.prototype._retrieveValues.call(this,t));case 5:case"end":return r.stop()}},_callee68,this)}));return function maxValues(){return e.apply(this,arguments)}}()},{key:"maxKeys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee69(){var e,t,n,r,a,i,o,s,u,c,l=arguments;return _regenerator["default"].wrap(function _callee69$(f){for(;;)switch(f.prev=f.next){case 0:e=l.length>0&&l[0]!==undefined?l[0]:null;if(!this._objectStore._truncated){f.next=5;break}t=new Set;f.next=8;break;case 5:f.next=7;return this._index.maxKeys(e);case 7:t=f.sent;case 8:n=Set.sampleElement(t);r=undefined,a=undefined;if(n===undefined){f.next=15;break}f.next=13;return this._backend.get(n);case 13:r=f.sent;a=x.byKeyPath(r,this.keyPath);case 15:t=(t=t.difference(this._objectStore._removed)).difference(this._objectStore._modified.keys());case 17:if(n===undefined||0!==t.size){f.next=35;break}i=A.upperBound(a,!0);f.next=21;return this._index.maxKeys(i);case 21:t=f.sent;if((n=Set.sampleElement(t))===undefined){f.next=28;break}f.next=26;return this._backend.get(n);case 26:r=f.sent;a=x.byKeyPath(r,this.keyPath);case 28:t=(t=t.difference(this._objectStore._removed)).difference(this._objectStore._modified.keys());if(!a||null===e||e.includes(a)){f.next=33;break}t=new Set;return f.abrupt("break",35);case 33:f.next=17;break;case 35:f.next=37;return C.prototype.maxKeys.call(this,e);case 37:o=f.sent;if(0!==t.size){f.next=42;break}return f.abrupt("return",o);case 42:if(0!==o.size){f.next=44;break}return f.abrupt("return",t);case 44:f.next=46;return this._objectStore.get(Set.sampleElement(o));case 46:s=f.sent;u=a;c=x.byKeyPath(s,this.keyPath);if(!(y.compare(u,c)>0)){f.next=53;break}return f.abrupt("return",t);case 53:if(!(y.compare(u,c)<0)){f.next=55;break}return f.abrupt("return",o);case 55:return f.abrupt("return",t.union(o));case 56:case"end":return f.stop()}},_callee69,this)}));return function maxKeys(){return e.apply(this,arguments)}}()},{key:"minValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee70(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee70$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.minKeys(e);case 3:t=r.sent;return r.abrupt("return",C.prototype._retrieveValues.call(this,t));case 5:case"end":return r.stop()}},_callee70,this)}));return function minValues(){return e.apply(this,arguments)}}()},{key:"minKeys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee71(){var e,t,n,r,a,i,o,s,u,c,l=arguments;return _regenerator["default"].wrap(function _callee71$(f){for(;;)switch(f.prev=f.next){case 0:e=l.length>0&&l[0]!==undefined?l[0]:null;if(!this._objectStore._truncated){f.next=5;break}t=new Set;f.next=8;break;case 5:f.next=7;return this._index.minKeys(e);case 7:t=f.sent;case 8:n=Set.sampleElement(t);r=undefined,a=undefined;if(n===undefined){f.next=15;break}f.next=13;return this._backend.get(n);case 13:r=f.sent;a=x.byKeyPath(r,this.keyPath);case 15:t=(t=t.difference(this._objectStore._removed)).difference(this._objectStore._modified.keys());case 17:if(n===undefined||0!==t.size){f.next=35;break}i=A.lowerBound(a,!0);f.next=21;return this._index.minKeys(i);case 21:t=f.sent;if((n=Set.sampleElement(t))===undefined){f.next=28;break}f.next=26;return this._backend.get(n);case 26:r=f.sent;a=x.byKeyPath(r,this.keyPath);case 28:t=(t=t.difference(this._objectStore._removed)).difference(this._objectStore._modified.keys());if(!a||null===e||e.includes(a)){f.next=33;break}t=new Set;return f.abrupt("break",35);case 33:f.next=17;break;case 35:f.next=37;return C.prototype.minKeys.call(this,e);case 37:o=f.sent;if(0!==t.size){f.next=42;break}return f.abrupt("return",o);case 42:if(0!==o.size){f.next=44;break}return f.abrupt("return",t);case 44:f.next=46;return this._objectStore.get(Set.sampleElement(o));case 46:s=f.sent;u=a;c=x.byKeyPath(s,this.keyPath);if(!(y.compare(u,c)<0)){f.next=53;break}return f.abrupt("return",t);case 53:if(!(y.compare(u,c)>0)){f.next=55;break}return f.abrupt("return",o);case 55:return f.abrupt("return",t.union(o));case 56:case"end":return f.stop()}},_callee71,this)}));return function minKeys(){return e.apply(this,arguments)}}()},{key:"count",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee72(){var e,t=arguments;return _regenerator["default"].wrap(function _callee72$(n){for(;;)switch(n.prev=n.next){case 0:e=t.length>0&&t[0]!==undefined?t[0]:null;n.next=3;return this.keys(e);case 3:return n.abrupt("return",n.sent.size);case 4:case"end":return n.stop()}},_callee72,this)}));return function count(){return e.apply(this,arguments)}}()}]);return TransactionIndex}(C);t.register(L);var R=function(){function Transaction(e,t,n){var r=this,a=!(arguments.length>3&&arguments[3]!==undefined)||arguments[3];(0,_classCallCheck2["default"])(this,Transaction);this._id=Transaction._instanceCount++;this._objectStore=e;this._parent=t;this._managingBackend=n||t;this._modified=new Map;this._removed=new Set;this._truncated=!1;this._indices=L.derive(this,t);this._state=Transaction.STATE.OPEN;this._nested=new Set;this._nestedCommitted=!1;this._dependency=null;this._snapshotManager=new G;this._startTime=Date.now();this._enableWatchdog=a;this._enableWatchdog&&(this._watchdog=setTimeout(function(){g.w(Transaction,"Violation: tx id ".concat(r._id," took longer than expected (still open after ").concat(Transaction.WATCHDOG_TIMER/1e3,"s), ").concat(r.toString(),"."))},Transaction.WATCHDOG_TIMER))}(0,_createClass2["default"])(Transaction,[{key:"_applySync",value:function _applySync(e){e._truncated&&this.truncateSync();var t,n=_createForOfIteratorHelper(e._modified);try{for(n.s();!(t=n.n()).done;){var r=(0,_slicedToArray2["default"])(t.value,2),a=r[0],i=r[1];this._put(a,i)}}catch(c){n.e(c)}finally{n.f()}var o,s=_createForOfIteratorHelper(e._removed);try{for(s.s();!(o=s.n()).done;){var u=o.value;this._remove(u)}}catch(c){s.e(c)}finally{s.f()}}},{key:"truncate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee73(){return _regenerator["default"].wrap(function _callee73$(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.truncateSync());case 1:case"end":return e.stop()}},_callee73,this)}));return function truncate(){return e.apply(this,arguments)}}()},{key:"truncateSync",value:function truncateSync(){if(this._state!==Transaction.STATE.OPEN)throw new Error("Transaction already closed");this._truncated=!0;this._modified.clear();this._removed.clear();var e,t=_createForOfIteratorHelper(this._indices.values());try{for(t.s();!(e=t.n()).done;){e.value.truncate()}}catch(n){t.e(n)}finally{t.f()}}},{key:"get",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee74(e){var t,n=arguments;return _regenerator["default"].wrap(function _callee74$(r){for(;;)switch(r.prev=r.next){case 0:t=n.length>1&&n[1]!==undefined?n[1]:{};if(!this._removed.has(e)){r.next=3;break}return r.abrupt("return",undefined);case 3:if(!this._modified.has(e)){r.next=7;break}if(!t||!t.raw){r.next=6;break}return r.abrupt("return",this.encode(this._modified.get(e)));case 6:return r.abrupt("return",this._modified.get(e));case 7:if(!this._truncated){r.next=9;break}return r.abrupt("return",undefined);case 9:return r.abrupt("return",this._parent.get(e,t));case 10:case"end":return r.stop()}},_callee74,this)}));return function get(t){return e.apply(this,arguments)}}()},{key:"put",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee75(e,t){var n,r,a,i;return _regenerator["default"].wrap(function _callee75$(o){for(;;)switch(o.prev=o.next){case 0:if(this._state===Transaction.STATE.OPEN){o.next=2;break}throw new Error("Transaction already closed");case 2:n=[];r=_createForOfIteratorHelper(this._indices.values());try{for(r.s();!(a=r.n()).done;){i=a.value;n.push(i.checkUniqueConstraint(e,t,!1))}}catch(s){r.e(s)}finally{r.f()}o.next=7;return Promise.all(n);case 7:this._put(e,t);case 8:case"end":return o.stop()}},_callee75,this)}));return function put(t,n){return e.apply(this,arguments)}}()},{key:"putSync",value:function putSync(e,t){if(this._state!==Transaction.STATE.OPEN)throw new Error("Transaction already closed");this._put(e,t)}},{key:"remove",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee76(e){return _regenerator["default"].wrap(function _callee76$(t){for(;;)switch(t.prev=t.next){case 0:if(this._state===Transaction.STATE.OPEN){t.next=2;break}throw new Error("Transaction already closed");case 2:this._remove(e);case 3:case"end":return t.stop()}},_callee76,this)}));return function remove(t){return e.apply(this,arguments)}}()},{key:"removeSync",value:function removeSync(e){if(this._state!==Transaction.STATE.OPEN)throw new Error("Transaction already closed");this._remove(e)}},{key:"keys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee77(){var e,t,n,r,a,i=arguments;return _regenerator["default"].wrap(function _callee77$(o){for(;;)switch(o.prev=o.next){case 0:if(!(null!==(e=i.length>0&&i[0]!==undefined?i[0]:null)&&e instanceof P)){o.next=3;break}return o.abrupt("return",e.keys(this));case 3:t=new Set;if(this._truncated){o.next=8;break}o.next=7;return this._parent.keys(e);case 7:t=o.sent;case 8:t=t.difference(this._removed);n=_createForOfIteratorHelper(this._modified.keys());try{for(n.s();!(r=n.n()).done;){a=r.value;(null===e||e.includes(a))&&t.add(a)}}catch(s){n.e(s)}finally{n.f()}return o.abrupt("return",t);case 12:case"end":return o.stop()}},_callee77,this)}));return function keys(){return e.apply(this,arguments)}}()},{key:"values",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee78(){var e,t,n,r,a,i,o=arguments;return _regenerator["default"].wrap(function _callee78$(s){for(;;)switch(s.prev=s.next){case 0:if(!(null!==(e=o.length>0&&o[0]!==undefined?o[0]:null)&&e instanceof P)){s.next=3;break}return s.abrupt("return",e.values(this));case 3:s.next=5;return this.keys(e);case 5:t=s.sent;n=[];r=_createForOfIteratorHelper(t);try{for(r.s();!(a=r.n()).done;){i=a.value;n.push(this.get(i))}}catch(u){r.e(u)}finally{r.f()}return s.abrupt("return",Promise.all(n));case 10:case"end":return s.stop()}},_callee78,this)}));return function values(){return e.apply(this,arguments)}}()},{key:"keyStream",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee79(e){var t,n,r,a,i,o=this,s=arguments;return _regenerator["default"].wrap(function _callee79$(u){for(;;)switch(u.prev=u.next){case 0:t=!(s.length>1&&s[1]!==undefined)||s[1];n=s.length>2&&s[2]!==undefined?s[2]:null;r=Array.from(this._modified.keys());n instanceof A&&(r=r.filter(function(e){return n.includes(e)}));r=r.sort();a=r.iterator(t);if(this._truncated){u.next=12;break}i=!1;u.next=10;return this._parent.keyStream(function(n){for(;a.hasNext()&&(t&&y.compare(a.peek(),n)<0||!t&&y.compare(a.peek(),n)>0);){var r=a.next();if(!e(r)){i=!0;return!1}}if(a.hasNext()&&y.equals(a.peek(),n)){var s=a.next();if(!e(s)){i=!0;return!1}return!0}if(!o._removed.has(n)&&!e(n)){i=!0;return!1}return!0},t,n);case 10:if(!i){u.next=12;break}return u.abrupt("return");case 12:if(!a.hasNext()){u.next=17;break}if(e(a.next())){u.next=15;break}return u.abrupt("break",17);case 15:u.next=12;break;case 17:case"end":return u.stop()}},_callee79,this)}));return function keyStream(t){return e.apply(this,arguments)}}()},{key:"valueStream",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee80(e){var t,n,r,a,i,o,s,u=this,c=arguments;return _regenerator["default"].wrap(function _callee80$(l){for(;;)switch(l.prev=l.next){case 0:t=!(c.length>1&&c[1]!==undefined)||c[1];n=c.length>2&&c[2]!==undefined?c[2]:null;r=Array.from(this._modified.keys());n instanceof A&&(r=r.filter(function(e){return n.includes(e)}));r=r.sort();a=r.iterator(t);if(this._truncated){l.next=12;break}i=!1;l.next=10;return this._parent.valueStream(function(n,r){for(;a.hasNext()&&(t&&y.compare(a.peek(),r)<0||!t&&y.compare(a.peek(),r)>0);){var o=a.next(),s=u._modified.get(o);if(!e(s,o)){i=!0;return!1}}if(a.hasNext()&&y.equals(a.peek(),r)){var c=a.next(),l=u._modified.get(c);if(!e(l,c)){i=!0;return!1}return!0}if(!u._removed.has(r)&&!e(n,r)){i=!0;return!1}return!0},t,n);case 10:if(!i){l.next=12;break}return l.abrupt("return");case 12:if(!a.hasNext()){l.next=21;break}o=a.next();l.next=16;return this.get(o);case 16:s=l.sent;if(e(s,o)){l.next=19;break}return l.abrupt("break",21);case 19:l.next=12;break;case 21:case"end":return l.stop()}},_callee80,this)}));return function valueStream(t){return e.apply(this,arguments)}}()},{key:"maxValue",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee81(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee81$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.maxKey(e);case 3:t=r.sent;return r.abrupt("return",this.get(t));case 5:case"end":return r.stop()}},_callee81,this)}));return function maxValue(){return e.apply(this,arguments)}}()},{key:"maxKey",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee82(){var e,t,n,r,a,i,o=arguments;return _regenerator["default"].wrap(function _callee82$(s){for(;;)switch(s.prev=s.next){case 0:e=o.length>0&&o[0]!==undefined?o[0]:null;t=undefined;if(this._truncated){s.next=6;break}s.next=5;return this._parent.maxKey(e);case 5:t=s.sent;case 6:if(t===undefined||!this._removed.has(t)){s.next=16;break}n=A.upperBound(t,!0);s.next=10;return this._parent.maxKey(n);case 10:t=s.sent;if(null===e||e.includes(t)){s.next=14;break}t=undefined;return s.abrupt("break",16);case 14:s.next=6;break;case 16:r=_createForOfIteratorHelper(this._modified.keys());try{for(r.s();!(a=r.n()).done;){i=a.value;(null===e||e.includes(i))&&(t===undefined||y.compare(i,t)>0)&&(t=i)}}catch(u){r.e(u)}finally{r.f()}return s.abrupt("return",t);case 19:case"end":return s.stop()}},_callee82,this)}));return function maxKey(){return e.apply(this,arguments)}}()},{key:"minValue",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee83(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee83$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.minKey(e);case 3:t=r.sent;return r.abrupt("return",this.get(t));case 5:case"end":return r.stop()}},_callee83,this)}));return function minValue(){return e.apply(this,arguments)}}()},{key:"minKey",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee84(){var e,t,n,r,a,i,o=arguments;return _regenerator["default"].wrap(function _callee84$(s){for(;;)switch(s.prev=s.next){case 0:e=o.length>0&&o[0]!==undefined?o[0]:null;t=undefined;if(this._truncated){s.next=6;break}s.next=5;return this._parent.minKey(e);case 5:t=s.sent;case 6:if(t===undefined||!this._removed.has(t)){s.next=16;break}n=A.lowerBound(t,!0);s.next=10;return this._parent.minKey(n);case 10:t=s.sent;if(null===e||e.includes(t)){s.next=14;break}t=undefined;return s.abrupt("break",16);case 14:s.next=6;break;case 16:r=_createForOfIteratorHelper(this._modified.keys());try{for(r.s();!(a=r.n()).done;){i=a.value;(null===e||e.includes(i))&&(t===undefined||i<t)&&(t=i)}}catch(u){r.e(u)}finally{r.f()}return s.abrupt("return",t);case 19:case"end":return s.stop()}},_callee84,this)}));return function minKey(){return e.apply(this,arguments)}}()},{key:"count",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee85(){var e,t=arguments;return _regenerator["default"].wrap(function _callee85$(n){for(;;)switch(n.prev=n.next){case 0:e=t.length>0&&t[0]!==undefined?t[0]:null;n.next=3;return this.keys(e);case 3:return n.abrupt("return",n.sent.size);case 4:case"end":return n.stop()}},_callee85,this)}));return function count(){return e.apply(this,arguments)}}()},{key:"index",value:function index(e){return this._indices.get(e)}},{key:"close",value:function close(){return this.abort()}},{key:"transaction",value:function transaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];if(this._state!==Transaction.STATE.OPEN&&this._state!==Transaction.STATE.NESTED)throw new Error("Transaction already closed");var t=new Transaction(this._objectStore,this,this,e);this._nested.add(t);this._state=Transaction.STATE.NESTED;return t}},{key:"synchronousTransaction",value:function synchronousTransaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];if(this._state!==Transaction.STATE.OPEN&&this._state!==Transaction.STATE.NESTED)throw new Error("Transaction already closed");var t=new N(this._objectStore,this,this,e);this._nested.add(t);this._state=Transaction.STATE.NESTED;return t}},{key:"isSynchronous",value:function isSynchronous(){return!1}},{key:"snapshot",value:function snapshot(){if(this.state!==Transaction.STATE.COMMITTED){var snapshot=this._managingBackend.snapshot();snapshot.inherit(this);return snapshot}return this._snapshotManager.createSnapshot(this._objectStore,this)}},{key:"toString",value:function toString(){return"Transaction{id=".concat(this._id,", changes=±").concat(this._modified.size+this._removed.size,", truncated=").concat(this._truncated,", objectStore=").concat(this._objectStore,", state=").concat(this._state,", dependency=").concat(this._dependency,"}")}},{key:"toStringShort",value:function toStringShort(){return"Transaction{id=".concat(this._id,", changes=±").concat(this._modified.size+this._removed.size,", truncated=").concat(this._truncated,", state=").concat(this._state,", dependency=").concat(this._dependency,"}")}},{key:"commit",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee86(e){return _regenerator["default"].wrap(function _callee86$(t){for(;;)switch(t.prev=t.next){case 0:if(e===undefined){t.next=8;break}if(this._isCommittable(e)){t.next=5;break}t.next=4;return this.abort(e);case 4:return t.abrupt("return",!1);case 5:t.next=7;return this._commitInternal(e);case 7:return t.abrupt("return",!0);case 8:if(null===this._dependency){t.next=10;break}return t.abrupt("return",this._dependency.commit());case 10:t.next=12;return this._checkConstraints();case 12:return t.abrupt("return",this._commitBackend());case 13:case"end":return t.stop()}},_callee86,this)}));return function commit(t){return e.apply(this,arguments)}}()},{key:"abort",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee87(e){return _regenerator["default"].wrap(function _callee87$(t){for(;;)switch(t.prev=t.next){case 0:if(e===undefined){t.next=8;break}if(!(e instanceof D)){t.next=3;break}return t.abrupt("return",this._snapshotManager.abortSnapshot(e));case 3:if(this._nested.has(e)&&e.state===Transaction.STATE.OPEN){t.next=5;break}throw new Error("Can only abort open, nested transactions");case 5:this._nested["delete"](e);if(0===this._nested.size){this._state=Transaction.STATE.OPEN;this._nestedCommitted=!1}return t.abrupt("return",!0);case 8:if(null===this._dependency){t.next=10;break}return t.abrupt("return",this._dependency.abort());case 10:return t.abrupt("return",this._abortBackend());case 11:case"end":return t.stop()}},_callee87,this)}));return function abort(t){return e.apply(this,arguments)}}()},{key:"_apply",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee88(e){return _regenerator["default"].wrap(function _callee88$(t){for(;;)switch(t.prev=t.next){case 0:if(e instanceof Transaction){t.next=2;break}throw new Error("Can only apply transactions");case 2:t.next=4;return this._snapshotManager.applyTx(e,this);case 4:this._applySync(e);case 5:case"end":return t.stop()}},_callee88,this)}));return function _apply(t){return e.apply(this,arguments)}}()},{key:"_commitBackend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee89(){var e;return _regenerator["default"].wrap(function _callee89$(t){for(;;)switch(t.prev=t.next){case 0:if(this._state===Transaction.STATE.OPEN){t.next=2;break}throw new Error("Transaction already closed or in nested state");case 2:this._enableWatchdog&&clearTimeout(this._watchdog);e=Date.now();t.next=6;return this._managingBackend.commit(this);case 6:if(!t.sent){t.next=13;break}this._state=Transaction.STATE.COMMITTED;this._performanceCheck(e,"commit");this._performanceCheck();return t.abrupt("return",!0);case 13:this._state=Transaction.STATE.CONFLICTED;this._performanceCheck(e,"commit");this._performanceCheck();return t.abrupt("return",!1);case 17:case"end":return t.stop()}},_callee89,this)}));return function _commitBackend(){return e.apply(this,arguments)}}()},{key:"_performanceCheck",value:function _performanceCheck(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._startTime,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null,n=Date.now()-e;t=t?" function '".concat(t,"'"):"";n>Transaction.WATCHDOG_TIMER&&g.w(Transaction,"Violation: tx id ".concat(this._id).concat(t," took ").concat((n/1e3).toFixed(2),"s (").concat(this.toString(),")."))}},{key:"_isCommittable",value:function _isCommittable(e){if(e!==undefined){if(!this._nested.has(e)||e.state!==Transaction.STATE.OPEN)throw new Error("Can only commit open, nested transactions");return!this._nestedCommitted}return this._managingBackend._isCommittable(this)}},{key:"_commitInternal",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee90(e){return _regenerator["default"].wrap(function _callee90$(t){for(;;)switch(t.prev=t.next){case 0:this._nested["delete"](e);this._nestedCommitted=!0;t.next=4;return this._apply(e);case 4:if(0===this._nested.size){this._state=Transaction.STATE.OPEN;this._nestedCommitted=!1}case 5:case"end":return t.stop()}},_callee90,this)}));return function _commitInternal(t){return e.apply(this,arguments)}}()},{key:"_setParent",value:function _setParent(e){this._parent=e}},{key:"_abortBackend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee91(){var e;return _regenerator["default"].wrap(function _callee91$(t){for(;;)switch(t.prev=t.next){case 0:if(this._state!==Transaction.STATE.ABORTED&&this._state!==Transaction.STATE.CONFLICTED){t.next=2;break}return t.abrupt("return",!0);case 2:if(this._state===Transaction.STATE.OPEN||this._state===Transaction.STATE.NESTED){t.next=4;break}throw new Error("Transaction already closed");case 4:if(this._state!==Transaction.STATE.NESTED){t.next=7;break}t.next=7;return Promise.all(Array.from(this._nested).map(function(e){return e.abort()}));case 7:this._enableWatchdog&&clearTimeout(this._watchdog);e=Date.now();t.next=11;return this._managingBackend.abort(this);case 11:this._setAborted();this._performanceCheck(e,"abort");this._performanceCheck();return t.abrupt("return",!0);case 15:case"end":return t.stop()}},_callee91,this)}));return function _abortBackend(){return e.apply(this,arguments)}}()},{key:"_setAborted",value:function _setAborted(){this._state=Transaction.STATE.ABORTED}},{key:"_put",value:function _put(e,t){this._removed["delete"](e);var n=this._modified.get(e);this._modified.set(e,t);var r,a=_createForOfIteratorHelper(this._indices.values());try{for(a.s();!(r=a.n()).done;){r.value.put(e,t,n)}}catch(i){a.e(i)}finally{a.f()}}},{key:"_remove",value:function _remove(e){this._removed.add(e);var t=this._modified.get(e);this._modified["delete"](e);var n,r=_createForOfIteratorHelper(this._indices.values());try{for(r.s();!(n=r.n()).done;){n.value.remove(e,t)}}catch(a){r.e(a)}finally{r.f()}}},{key:"_checkConstraints",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee92(){var e,t,n,r,a,i,o,s,u;return _regenerator["default"].wrap(function _callee92$(c){for(;;)switch(c.prev=c.next){case 0:e=[];t=_createForOfIteratorHelper(this._indices.values());c.prev=2;t.s();case 4:if((n=t.n()).done){c.next=12;break}if((r=n.value).unique){c.next=8;break}return c.abrupt("continue",10);case 8:a=_createForOfIteratorHelper(this._modified);try{for(a.s();!(i=a.n()).done;){o=(0,_slicedToArray2["default"])(i.value,2),s=o[0],u=o[1];e.push(r.checkUniqueConstraint(s,u))}}catch(l){a.e(l)}finally{a.f()}case 10:c.next=4;break;case 12:c.next=17;break;case 14:c.prev=14;c.t0=c["catch"](2);t.e(c.t0);case 17:c.prev=17;t.f();return c.finish(17);case 20:if(!(e.length>0)){c.next=31;break}c.prev=21;c.next=24;return Promise.all(e);case 24:c.next=31;break;case 26:c.prev=26;c.t1=c["catch"](21);c.next=30;return this.abort();case 30:throw c.t1;case 31:case"end":return c.stop()}},_callee92,this,[[2,14,17,20],[21,26]])}));return function _checkConstraints(){return e.apply(this,arguments)}}()},{key:"decode",value:function decode(e,t){return this._objectStore.decode(e,t)}},{key:"encode",value:function encode(e){return this._objectStore.encode(e)}},{key:"objectStore",get:function get(){return this._objectStore}},{key:"nested",get:function get(){return this._managingBackend instanceof Transaction}},{key:"dependency",get:function get(){return this._dependency}},{key:"connected",get:function get(){return this._managingBackend.connected}},{key:"id",get:function get(){return this._id}},{key:"indices",get:function get(){return this._indices}},{key:"state",get:function get(){return this._state}}]);return Transaction}();R.WATCHDOG_TIMER=5e3;R.STATE={OPEN:0,COMMITTED:1,ABORTED:2,CONFLICTED:3,NESTED:4};R._instanceCount=0;t.register(R);var N=function(e){(0,_inherits2["default"])(SynchronousTransaction,e);var t=_createSuper(SynchronousTransaction);function SynchronousTransaction(e,n,r){var a,i=!(arguments.length>3&&arguments[3]!==undefined)||arguments[3];(0,_classCallCheck2["default"])(this,SynchronousTransaction);(a=t.call(this,e,n,r,i))._cache=new Map;return a}(0,_createClass2["default"])(SynchronousTransaction,[{key:"preload",value:function preload(e){var t=this;e=e.filter(function(e){return!t.isCached(e)});return Promise.all(e.map(function(e){return t.get(e)}))}},{key:"isCached",value:function isCached(e){return this._cache.has(e)||!!this._parent.isSynchronous()&&this._parent.isCached(e)}},{key:"get",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee93(e){var t,n,r=arguments;return _regenerator["default"].wrap(function _callee93$(a){for(;;)switch(a.prev=a.next){case 0:(t=r.length>1&&r[1]!==undefined?r[1]:{}).expectPresence=!1;if(!this.isCached(e)){a.next=6;break}n=this.getSync(e,t);a.next=10;break;case 6:a.next=8;return R.prototype.get.call(this,e,t);case 8:n=a.sent;t&&t.raw?this._cache.set(e,this.decode(n,e)):this._cache.set(e,n);case 10:return a.abrupt("return",n);case 11:case"end":return a.stop()}},_callee93,this)}));return function get(t){return e.apply(this,arguments)}}()},{key:"_getCached",value:function _getCached(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},n=(t||{}).expectPresence,r=void 0===n||n,a=this._cache.get(e);if(!a&&this._parent.isSynchronous())return this._parent.getSync(e,t);if(r&&!a)throw new Error("Missing key in cache: ".concat(e));t&&t.raw&&(a=this.encode(a));return a}},{key:"getSync",value:function getSync(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return this._removed.has(e)?undefined:this._modified.has(e)?t&&t.raw?this.encode(this._modified.get(e)):this._modified.get(e):this._truncated?undefined:this._getCached(e,t)}},{key:"isSynchronous",value:function isSynchronous(){return!0}}]);return SynchronousTransaction}(R);t.register(N);var D=function(e){(0,_inherits2["default"])(Snapshot,e);var t=_createSuper(Snapshot);function Snapshot(e,n){(0,_classCallCheck2["default"])(this,Snapshot);return t.call(this,e,n,e,!1)}(0,_createClass2["default"])(Snapshot,[{key:"inherit",value:function inherit(e){if(!(e instanceof R))throw new Error("Can only inherit transactions");return(0,_get6["default"])((0,_getPrototypeOf2["default"])(Snapshot.prototype),"_applySync",this).call(this,e)}},{key:"_apply",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee94(e){var t,n,r,a,i,o,s,u,c,l,f=this;return _regenerator["default"].wrap(function _callee94$(h){for(;;)switch(h.prev=h.next){case 0:if(e instanceof R){h.next=2;break}throw new Error("Can only apply transactions");case 2:if(!e._truncated){h.next=5;break}h.next=5;return this.valueStream(function(e,t){f._modified.has(t)||f._put(t,e);return!0});case 5:t=_createForOfIteratorHelper(e._modified);h.prev=6;t.s();case 8:if((n=t.n()).done){h.next=18;break}r=(0,_slicedToArray2["default"])(n.value,2),a=r[0],i=r[1];if(!this._modified.has(a)){h.next=12;break}return h.abrupt("continue",16);case 12:h.next=14;return this.get(a);case 14:(o=h.sent)?this._put(a,o,i):this._remove(a,i);case 16:h.next=8;break;case 18:h.next=23;break;case 20:h.prev=20;h.t0=h["catch"](6);t.e(h.t0);case 23:h.prev=23;t.f();return h.finish(23);case 26:s=_createForOfIteratorHelper(e._removed);h.prev=27;s.s();case 29:if((u=s.n()).done){h.next=39;break}c=u.value;if(!this._modified.has(c)){h.next=33;break}return h.abrupt("continue",37);case 33:h.next=35;return this.get(c);case 35:l=h.sent;this._put(c,l);case 37:h.next=29;break;case 39:h.next=44;break;case 41:h.prev=41;h.t1=h["catch"](27);s.e(h.t1);case 44:h.prev=44;s.f();return h.finish(44);case 47:case"end":return h.stop()}},_callee94,this,[[6,20,23,26],[27,41,44,47]])}));return function _apply(t){return e.apply(this,arguments)}}()},{key:"truncate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee95(){return _regenerator["default"].wrap(function _callee95$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Unsupported operation on snapshots: truncate");case 1:case"end":return e.stop()}},_callee95)}));return function truncate(){return e.apply(this,arguments)}}()},{key:"truncateSync",value:function truncateSync(){throw new Error("Unsupported operation on snapshots: truncateSync")}},{key:"commit",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee96(e){return _regenerator["default"].wrap(function _callee96$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Cannot commit snapshots: commit");case 1:case"end":return e.stop()}},_callee96)}));return function commit(t){return e.apply(this,arguments)}}()},{key:"_isCommittable",value:function _isCommittable(e){return!1}},{key:"_commitInternal",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee97(e){return _regenerator["default"].wrap(function _callee97$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Cannot commit snapshots");case 1:case"end":return e.stop()}},_callee97)}));return function _commitInternal(t){return e.apply(this,arguments)}}()},{key:"_commitBackend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee98(){return _regenerator["default"].wrap(function _callee98$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Cannot commit snapshots");case 1:case"end":return e.stop()}},_callee98)}));return function _commitBackend(){return e.apply(this,arguments)}}()},{key:"abort",value:function abort(e){return this._abortBackend()}},{key:"_abortBackend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee99(){var e,t;return _regenerator["default"].wrap(function _callee99$(n){for(;;)switch(n.prev=n.next){case 0:if(this._state===R.STATE.OPEN){n.next=2;break}throw new Error("Snapshot already closed");case 2:n.next=4;return this._managingBackend.abort(this);case 4:if(n.sent){n.next=7;break}return n.abrupt("return",!1);case 7:this._state=R.STATE.ABORTED;this._truncated=!0;this._modified.clear();this._removed.clear();e=_createForOfIteratorHelper(this._indices.values());try{for(e.s();!(t=e.n()).done;)t.value.truncate()}catch(r){e.e(r)}finally{e.f()}return n.abrupt("return",!0);case 14:case"end":return n.stop()}},_callee99,this)}));return function _abortBackend(){return e.apply(this,arguments)}}()},{key:"put",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee100(e,t){return _regenerator["default"].wrap(function _callee100$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Unsupported operation on snapshots: put");case 1:case"end":return e.stop()}},_callee100)}));return function put(t,n){return e.apply(this,arguments)}}()},{key:"putSync",value:function putSync(e,t){throw new Error("Unsupported operation on snapshots: putSync")}},{key:"remove",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee101(e){return _regenerator["default"].wrap(function _callee101$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Unsupported operation on snapshots: remove");case 1:case"end":return e.stop()}},_callee101)}));return function remove(t){return e.apply(this,arguments)}}()},{key:"removeSync",value:function removeSync(e){throw new Error("Unsupported operation on snapshots: removeSync")}},{key:"close",value:function close(){return this.abort()}},{key:"transaction",value:function transaction(){throw new Error("Unsupported operation on snapshots: transaction")}},{key:"synchronousTransaction",value:function synchronousTransaction(){throw new Error("Unsupported operation on snapshots: synchronousTransaction")}},{key:"snapshot",value:function snapshot(){throw new Error("Unsupported operation on snapshots: snapshot")}}]);return Snapshot}(R);t.register(D);var G=function(){function SnapshotManager(){(0,_classCallCheck2["default"])(this,SnapshotManager);this._snapshots=new Set}(0,_createClass2["default"])(SnapshotManager,[{key:"createSnapshot",value:function createSnapshot(e,t){var n=new D(e,t);this._snapshots.add(n);return n}},{key:"abortSnapshot",value:function abortSnapshot(e){return this._snapshots["delete"](e)}},{key:"applyTx",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee102(e,t){var n,r,a,i,o,s,u;return _regenerator["default"].wrap(function _callee102$(c){for(;;)switch(c.prev=c.next){case 0:if(e instanceof R){c.next=2;break}throw new Error("Can only apply transactions");case 2:n=[];r=_createForOfIteratorHelper(this._snapshots);try{for(r.s();!(a=r.n()).done;){i=a.value;n.push(i._apply(e))}}catch(l){r.e(l)}finally{r.f()}o=_createForOfIteratorHelper(e._snapshotManager);try{for(o.s();!(s=o.n()).done;){(u=s.value)._backend=t;this._snapshots.add(u)}}catch(l){o.e(l)}finally{o.f()}return c.abrupt("return",Promise.all(n));case 8:case"end":return c.stop()}},_callee102,this)}));return function applyTx(t,n){return e.apply(this,arguments)}}()},{key:Symbol.iterator,value:function value(){return this._snapshots.values()}}]);return SnapshotManager}();t.register(G);var K=function(){function CombinedTransaction(){(0,_classCallCheck2["default"])(this,CombinedTransaction);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!this.isConsistent(t))throw new Error("Given set of transactions violates rules for combined transactions");this._transactions=t;this._flushable=new Map;this._preprocessing=[];this._dependency=this}(0,_createClass2["default"])(CombinedTransaction,[{key:"isConsistent",value:function isConsistent(e){var t=new Set;this._jdb=null;var n,r=_createForOfIteratorHelper(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.state!==R.STATE.OPEN)return!1;if(a.nested)return!1;if(t.has(a._objectStore))return!1;if(null===this._jdb)this._jdb=a._objectStore.jungleDB;else if(this._jdb!==a._objectStore.jungleDB&&null!==a._objectStore.jungleDB)return!1;t.add(a._objectStore)}}catch(i){r.e(i)}finally{r.f()}return!0}},{key:"onFlushable",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee103(e){var t,n,r,a,o,s,u,c,l=this,f=arguments;return _regenerator["default"].wrap(function _callee103$(h){for(;;)switch(h.prev=h.next){case 0:t=f.length>1&&f[1]!==undefined?f[1]:null;n=f.length>2&&f[2]!==undefined?f[2]:null;this._flushable.set(e,t);null!==n&&this._preprocessing.push(n);if(!this._transactions.every(function(e){return l._flushable.has(e)})){h.next=15;break}r=[];a=_createForOfIteratorHelper(this._preprocessing);try{for(a.s();!(o=a.n()).done;){s=o.value;r.push(s())}}catch(d){a.e(d)}finally{a.f()}h.next=10;return Promise.all(r);case 10:h.next=12;return i.commitCombined(this);case 12:u=_createForOfIteratorHelper(this._flushable.values());try{for(u.s();!(c=u.n()).done;)(0,c.value)()}catch(d){u.e(d)}finally{u.f()}return h.abrupt("return",!0);case 15:return h.abrupt("return",!1);case 16:case"end":return h.stop()}},_callee103,this)}));return function onFlushable(t){return e.apply(this,arguments)}}()},{key:"commit",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee104(){return _regenerator["default"].wrap(function _callee104$(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isCommittable()){e.next=6;break}e.next=3;return this._checkConstraints();case 3:e.next=5;return this._commitBackend();case 5:return e.abrupt("return",!0);case 6:e.next=8;return this.abort();case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}},_callee104,this)}));return function commit(){return e.apply(this,arguments)}}()},{key:"abort",value:function abort(){return this._abortBackend()}},{key:"_abortBackend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee105(){return _regenerator["default"].wrap(function _callee105$(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return Promise.all(this._transactions.map(function(e){return e._abortBackend()}));case 2:return e.abrupt("return",e.sent.every(function(e){return e}));case 3:case"end":return e.stop()}},_callee105,this)}));return function _abortBackend(){return e.apply(this,arguments)}}()},{key:"transaction",value:function transaction(e){throw new Error("Unsupported operation")}},{key:"snapshot",value:function snapshot(){throw new Error("Unsupported operation")}},{key:"_isCommittable",value:function _isCommittable(){return this._transactions.every(function(e){return e._isCommittable()})}},{key:"_checkConstraints",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee106(){return _regenerator["default"].wrap(function _callee106$(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0;e.next=3;return Promise.all(this._transactions.map(function(e){return e._checkConstraints()}));case 3:e.next=10;break;case 5:e.prev=5;e.t0=e["catch"](0);e.next=9;return this.abort();case 9:throw e.t0;case 10:case"end":return e.stop()}},_callee106,this,[[0,5]])}));return function _checkConstraints(){return e.apply(this,arguments)}}()},{key:"_commitBackend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee107(){return _regenerator["default"].wrap(function _callee107$(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return Promise.all(this._transactions.map(function(e){return e._commitBackend()}));case 2:return e.abrupt("return",e.sent.every(function(e){return e}));case 3:case"end":return e.stop()}},_callee107,this)}));return function _commitBackend(){return e.apply(this,arguments)}}()},{key:"_commitInternal",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee108(e){return _regenerator["default"].wrap(function _callee108$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Cannot commit transactions to a combined transaction");case 1:case"end":return e.stop()}},_callee108)}));return function _commitInternal(t){return e.apply(this,arguments)}}()},{key:"_setParent",value:function _setParent(e){throw new Error("Unsupported operation")}},{key:"toString",value:function toString(){return"CombinedTransaction{size=".concat(this._transactions.length,", states=[").concat(this._transactions.map(function(e){return e.state}),"]}")}},{key:"backend",get:function get(){return this._jdb}},{key:"transactions",get:function get(){return this._transactions}},{key:"_dependency",set:function set(e){var t,n=_createForOfIteratorHelper(this._transactions);try{for(n.s();!(t=n.n()).done;){t.value._dependency=e}}catch(r){n.e(r)}finally{n.f()}}},{key:"dependency",get:function get(){return this}},{key:"objectStore",get:function get(){throw new Error("Unsupported operation")}}]);return CombinedTransaction}();t.register(K);e._loaded=!0;"function"==typeof e._onload&&e._onload()}(JDB);
//# sourceMappingURL=indexeddb-babel.js.map
